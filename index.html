<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0A0F1C" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>Muslim Companion</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    html, body, #root { margin:0; padding:0; min-height:100vh; background:#0A0F1C; }
    #splash {
      position:fixed; inset:0; z-index:9999; background:#0A0F1C;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      font-family: -apple-system, sans-serif; color:#D4A843;
    }
    #splash .title { font-size:24px; font-weight:700; margin-bottom:6px; }
    #splash .sub { font-size:12px; color:#64748B; letter-spacing:2px; text-transform:uppercase; }
    #splash .loader { margin-top:24px; width:36px; height:36px; border:3px solid #2A3654;
      border-top-color:#D4A843; border-radius:50%; animation:sp .8s linear infinite; }
    @keyframes sp { to { transform:rotate(360deg); } }
  </style>
</head>
<body>
  <div id="splash">
    <div style="font-size:28px; margin-bottom:16px; opacity:0.5;">Ô∑Ω</div>
    <div class="title">Muslim Companion</div>
    <div class="sub">Loading your Islamic guide...</div>
    <div class="loader"></div>
  </div>
  <div id="root"></div>

  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.2/babel.min.js"></script>
  <script type="text/babel" data-presets="react">
const { useState, useEffect, useCallback, useRef } = React;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const NAMES_OF_ALLAH = [
  { number: 1, arabic: "Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÄŸ∞ŸÜŸè", transliteration: "Ar-Rahman", meaning: "The Most Gracious" },
  { number: 2, arabic: "Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸè", transliteration: "Ar-Raheem", meaning: "The Most Merciful" },
  { number: 3, arabic: "Ÿ±ŸÑŸíŸÖŸéŸÑŸêŸÉŸè", transliteration: "Al-Malik", meaning: "The King" },
  { number: 4, arabic: "Ÿ±ŸÑŸíŸÇŸèÿØŸèŸëŸàÿ≥Ÿè", transliteration: "Al-Quddus", meaning: "The Most Holy" },
  { number: 5, arabic: "Ÿ±ŸÑÿ≥ŸéŸëŸÑŸéÿßŸÖŸè", transliteration: "As-Salam", meaning: "The Source of Peace" },
  { number: 6, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸè", transliteration: "Al-Mu'min", meaning: "The Guardian of Faith" },
  { number: 7, arabic: "Ÿ±ŸÑŸíŸÖŸèŸáŸéŸäŸíŸÖŸêŸÜŸè", transliteration: "Al-Muhaymin", meaning: "The Protector" },
  { number: 8, arabic: "Ÿ±ŸÑŸíÿπŸéÿ≤ŸêŸäÿ≤Ÿè", transliteration: "Al-Aziz", meaning: "The Almighty" },
  { number: 9, arabic: "Ÿ±ŸÑŸíÿ¨Ÿéÿ®ŸéŸëÿßÿ±Ÿè", transliteration: "Al-Jabbar", meaning: "The Compeller" },
  { number: 10, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ™ŸéŸÉŸéÿ®ŸêŸëÿ±Ÿè", transliteration: "Al-Mutakabbir", meaning: "The Supreme" },
  { number: 11, arabic: "Ÿ±ŸÑŸíÿÆŸéÿßŸÑŸêŸÇŸè", transliteration: "Al-Khaliq", meaning: "The Creator" },
  { number: 12, arabic: "Ÿ±ŸÑŸíÿ®Ÿéÿßÿ±Ÿêÿ¶Ÿè", transliteration: "Al-Bari", meaning: "The Evolver" },
  { number: 13, arabic: "Ÿ±ŸÑŸíŸÖŸèÿµŸéŸàŸêŸëÿ±Ÿè", transliteration: "Al-Musawwir", meaning: "The Fashioner" },
  { number: 14, arabic: "Ÿ±ŸÑŸíÿ∫ŸéŸÅŸéŸëÿßÿ±Ÿè", transliteration: "Al-Ghaffar", meaning: "The Ever-Forgiving" },
  { number: 15, arabic: "Ÿ±ŸÑŸíŸÇŸéŸáŸéŸëÿßÿ±Ÿè", transliteration: "Al-Qahhar", meaning: "The Subduer" },
  { number: 16, arabic: "Ÿ±ŸÑŸíŸàŸéŸáŸéŸëÿßÿ®Ÿè", transliteration: "Al-Wahhab", meaning: "The Bestower" },
  { number: 17, arabic: "Ÿ±ŸÑÿ±ŸéŸëÿ≤ŸéŸëÿßŸÇŸè", transliteration: "Ar-Razzaq", meaning: "The Provider" },
  { number: 18, arabic: "Ÿ±ŸÑŸíŸÅŸéÿ™ŸéŸëÿßÿ≠Ÿè", transliteration: "Al-Fattah", meaning: "The Opener" },
  { number: 19, arabic: "Ÿ±ŸÑŸíÿπŸéŸÑŸêŸäŸÖŸè", transliteration: "Al-Alim", meaning: "The All-Knowing" },
  { number: 20, arabic: "Ÿ±ŸÑŸíŸÇŸéÿßÿ®Ÿêÿ∂Ÿè", transliteration: "Al-Qabid", meaning: "The Restrainer" },
  { number: 21, arabic: "Ÿ±ŸÑŸíÿ®Ÿéÿßÿ≥Ÿêÿ∑Ÿè", transliteration: "Al-Basit", meaning: "The Extender" },
  { number: 22, arabic: "Ÿ±ŸÑŸíÿÆŸéÿßŸÅŸêÿ∂Ÿè", transliteration: "Al-Khafid", meaning: "The Abaser" },
  { number: 23, arabic: "Ÿ±ŸÑÿ±ŸéŸëÿßŸÅŸêÿπŸè", transliteration: "Ar-Rafi", meaning: "The Exalter" },
  { number: 24, arabic: "Ÿ±ŸÑŸíŸÖŸèÿπŸêÿ≤ŸèŸë", transliteration: "Al-Mu'izz", meaning: "The Honorer" },
  { number: 25, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ∞ŸêŸÑŸèŸë", transliteration: "Al-Mudhill", meaning: "The Humiliator" },
  { number: 26, arabic: "Ÿ±ŸÑÿ≥ŸéŸëŸÖŸêŸäÿπŸè", transliteration: "As-Sami", meaning: "The All-Hearing" },
  { number: 27, arabic: "Ÿ±ŸÑŸíÿ®ŸéÿµŸêŸäÿ±Ÿè", transliteration: "Al-Basir", meaning: "The All-Seeing" },
  { number: 28, arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÉŸéŸÖŸè", transliteration: "Al-Hakam", meaning: "The Judge" },
  { number: 29, arabic: "Ÿ±ŸÑŸíÿπŸéÿØŸíŸÑŸè", transliteration: "Al-Adl", meaning: "The Just" },
  { number: 30, arabic: "Ÿ±ŸÑŸÑŸéŸëÿ∑ŸêŸäŸÅŸè", transliteration: "Al-Latif", meaning: "The Subtle One" },
  { number: 31, arabic: "Ÿ±ŸÑŸíÿÆŸéÿ®ŸêŸäÿ±Ÿè", transliteration: "Al-Khabir", meaning: "The All-Aware" },
  { number: 32, arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÑŸêŸäŸÖŸè", transliteration: "Al-Halim", meaning: "The Forbearing" },
  { number: 33, arabic: "Ÿ±ŸÑŸíÿπŸéÿ∏ŸêŸäŸÖŸè", transliteration: "Al-Azim", meaning: "The Magnificent" },
  { number: 34, arabic: "Ÿ±ŸÑŸíÿ∫ŸéŸÅŸèŸàÿ±Ÿè", transliteration: "Al-Ghafur", meaning: "The All-Forgiving" },
  { number: 35, arabic: "Ÿ±ŸÑÿ¥ŸéŸëŸÉŸèŸàÿ±Ÿè", transliteration: "Ash-Shakur", meaning: "The Appreciative" },
  { number: 36, arabic: "Ÿ±ŸÑŸíÿπŸéŸÑŸêŸäŸèŸë", transliteration: "Al-Ali", meaning: "The Most High" },
  { number: 37, arabic: "Ÿ±ŸÑŸíŸÉŸéÿ®ŸêŸäÿ±Ÿè", transliteration: "Al-Kabir", meaning: "The Most Great" },
  { number: 38, arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÅŸêŸäÿ∏Ÿè", transliteration: "Al-Hafiz", meaning: "The Preserver" },
  { number: 39, arabic: "Ÿ±ŸÑŸíŸÖŸèŸÇŸêŸäÿ™Ÿè", transliteration: "Al-Muqit", meaning: "The Sustainer" },
  { number: 40, arabic: "Ÿ±ŸÑŸíÿ≠Ÿéÿ≥ŸêŸäÿ®Ÿè", transliteration: "Al-Hasib", meaning: "The Reckoner" },
  { number: 41, arabic: "Ÿ±ŸÑŸíÿ¨ŸéŸÑŸêŸäŸÑŸè", transliteration: "Al-Jalil", meaning: "The Majestic" },
  { number: 42, arabic: "Ÿ±ŸÑŸíŸÉŸéÿ±ŸêŸäŸÖŸè", transliteration: "Al-Karim", meaning: "The Generous" },
  { number: 43, arabic: "Ÿ±ŸÑÿ±ŸéŸëŸÇŸêŸäÿ®Ÿè", transliteration: "Ar-Raqib", meaning: "The Watchful" },
  { number: 44, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ¨ŸêŸäÿ®Ÿè", transliteration: "Al-Mujib", meaning: "The Responsive" },
  { number: 45, arabic: "Ÿ±ŸÑŸíŸàŸéÿßÿ≥ŸêÿπŸè", transliteration: "Al-Wasi", meaning: "The All-Encompassing" },
  { number: 46, arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÉŸêŸäŸÖŸè", transliteration: "Al-Hakim", meaning: "The All-Wise" },
  { number: 47, arabic: "Ÿ±ŸÑŸíŸàŸéÿØŸèŸàÿØŸè", transliteration: "Al-Wadud", meaning: "The Most Loving" },
  { number: 48, arabic: "Ÿ±ŸÑŸíŸÖŸéÿ¨ŸêŸäÿØŸè", transliteration: "Al-Majid", meaning: "The Most Glorious" },
  { number: 49, arabic: "Ÿ±ŸÑŸíÿ®ŸéÿßÿπŸêÿ´Ÿè", transliteration: "Al-Ba'ith", meaning: "The Resurrector" },
  { number: 50, arabic: "Ÿ±ŸÑÿ¥ŸéŸëŸáŸêŸäÿØŸè", transliteration: "Ash-Shahid", meaning: "The Witness" },
  { number: 51, arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÇŸèŸë", transliteration: "Al-Haqq", meaning: "The Truth" },
  { number: 52, arabic: "Ÿ±ŸÑŸíŸàŸéŸÉŸêŸäŸÑŸè", transliteration: "Al-Wakil", meaning: "The Trustee" },
  { number: 53, arabic: "Ÿ±ŸÑŸíŸÇŸéŸàŸêŸäŸèŸë", transliteration: "Al-Qawiy", meaning: "The Most Strong" },
  { number: 54, arabic: "Ÿ±ŸÑŸíŸÖŸéÿ™ŸêŸäŸÜŸè", transliteration: "Al-Matin", meaning: "The Firm One" },
  { number: 55, arabic: "Ÿ±ŸÑŸíŸàŸéŸÑŸêŸäŸèŸë", transliteration: "Al-Waliy", meaning: "The Protecting Friend" },
  { number: 56, arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÖŸêŸäÿØŸè", transliteration: "Al-Hamid", meaning: "The Praiseworthy" },
  { number: 57, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ≠ŸíÿµŸêŸäŸèŸë", transliteration: "Al-Muhsi", meaning: "The Appraiser" },
  { number: 58, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ®ŸíÿØŸêÿ¶Ÿè", transliteration: "Al-Mubdi", meaning: "The Originator" },
  { number: 59, arabic: "Ÿ±ŸÑŸíŸÖŸèÿπŸêŸäÿØŸè", transliteration: "Al-Mu'id", meaning: "The Restorer" },
  { number: 60, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ≠ŸíŸäŸêŸâ", transliteration: "Al-Muhyi", meaning: "The Giver of Life" },
  { number: 61, arabic: "Ÿ±ŸÑŸíŸÖŸèŸÖŸêŸäÿ™Ÿè", transliteration: "Al-Mumit", meaning: "The Bringer of Death" },
  { number: 62, arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸâŸèŸë", transliteration: "Al-Hayy", meaning: "The Ever-Living" },
  { number: 63, arabic: "Ÿ±ŸÑŸíŸÇŸéŸäŸèŸëŸàŸÖŸè", transliteration: "Al-Qayyum", meaning: "The Self-Subsisting" },
  { number: 64, arabic: "Ÿ±ŸÑŸíŸàŸéÿßÿ¨ŸêÿØŸè", transliteration: "Al-Wajid", meaning: "The Finder" },
  { number: 65, arabic: "Ÿ±ŸÑŸíŸÖŸéÿßÿ¨ŸêÿØŸè", transliteration: "Al-Majid", meaning: "The Noble" },
  { number: 66, arabic: "Ÿ±ŸÑŸíŸàŸéÿßÿ≠ŸêÿØŸè", transliteration: "Al-Wahid", meaning: "The One" },
  { number: 67, arabic: "Ÿ±ŸÑŸíÿ£Ÿéÿ≠ŸéÿØŸè", transliteration: "Al-Ahad", meaning: "The Unique" },
  { number: 68, arabic: "Ÿ±ŸÑÿµŸéŸëŸÖŸéÿØŸè", transliteration: "As-Samad", meaning: "The Eternal" },
  { number: 69, arabic: "Ÿ±ŸÑŸíŸÇŸéÿßÿØŸêÿ±Ÿè", transliteration: "Al-Qadir", meaning: "The Able" },
  { number: 70, arabic: "Ÿ±ŸÑŸíŸÖŸèŸÇŸíÿ™ŸéÿØŸêÿ±Ÿè", transliteration: "Al-Muqtadir", meaning: "The Powerful" },
  { number: 71, arabic: "Ÿ±ŸÑŸíŸÖŸèŸÇŸéÿØŸêŸëŸÖŸè", transliteration: "Al-Muqaddim", meaning: "The Expediter" },
  { number: 72, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ§ŸéÿÆŸêŸëÿ±Ÿè", transliteration: "Al-Mu'akhkhir", meaning: "The Delayer" },
  { number: 73, arabic: "Ÿ±ŸÑŸíÿ£ŸéŸàŸéŸëŸÑŸè", transliteration: "Al-Awwal", meaning: "The First" },
  { number: 74, arabic: "Ÿ±ŸÑŸíÿ¢ÿÆŸêÿ±Ÿè", transliteration: "Al-Akhir", meaning: "The Last" },
  { number: 75, arabic: "Ÿ±ŸÑÿ∏ŸéŸëÿßŸáŸêÿ±Ÿè", transliteration: "Az-Zahir", meaning: "The Manifest" },
  { number: 76, arabic: "Ÿ±ŸÑŸíÿ®Ÿéÿßÿ∑ŸêŸÜŸè", transliteration: "Al-Batin", meaning: "The Hidden" },
  { number: 77, arabic: "Ÿ±ŸÑŸíŸàŸéÿßŸÑŸêŸä", transliteration: "Al-Wali", meaning: "The Governor" },
  { number: 78, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ™ŸéÿπŸéÿßŸÑŸêŸä", transliteration: "Al-Muta'ali", meaning: "The Most Exalted" },
  { number: 79, arabic: "Ÿ±ŸÑŸíÿ®Ÿéÿ±ŸèŸë", transliteration: "Al-Barr", meaning: "The Source of Goodness" },
  { number: 80, arabic: "Ÿ±ŸÑÿ™ŸéŸëŸàŸéŸëÿßÿ®Ÿè", transliteration: "At-Tawwab", meaning: "The Ever-Accepting of Repentance" },
  { number: 81, arabic: "Ÿ±ŸÑŸíŸÖŸèŸÜŸíÿ™ŸéŸÇŸêŸÖŸè", transliteration: "Al-Muntaqim", meaning: "The Avenger" },
  { number: 82, arabic: "Ÿ±ŸÑŸíÿπŸéŸÅŸèŸàŸèŸë", transliteration: "Al-Afuw", meaning: "The Pardoner" },
  { number: 83, arabic: "Ÿ±ŸÑÿ±ŸéŸëÿ°ŸèŸàŸÅŸè", transliteration: "Ar-Ra'uf", meaning: "The Most Kind" },
  { number: 84, arabic: "ŸÖŸéÿßŸÑŸêŸÉŸè Ÿ±ŸÑŸíŸÖŸèŸÑŸíŸÉŸê", transliteration: "Malik-ul-Mulk", meaning: "Owner of Sovereignty" },
  { number: 85, arabic: "ÿ∞ŸèŸà Ÿ±ŸÑŸíÿ¨ŸéŸÑŸéÿßŸÑŸê ŸàŸéŸ±ŸÑŸíÿ•ŸêŸÉŸíÿ±ŸéÿßŸÖŸê", transliteration: "Dhul-Jalali wal-Ikram", meaning: "Lord of Majesty and Generosity" },
  { number: 86, arabic: "Ÿ±ŸÑŸíŸÖŸèŸÇŸíÿ≥Ÿêÿ∑Ÿè", transliteration: "Al-Muqsit", meaning: "The Equitable" },
  { number: 87, arabic: "Ÿ±ŸÑŸíÿ¨ŸéÿßŸÖŸêÿπŸè", transliteration: "Al-Jami", meaning: "The Gatherer" },
  { number: 88, arabic: "Ÿ±ŸÑŸíÿ∫ŸéŸÜŸêŸäŸèŸë", transliteration: "Al-Ghani", meaning: "The Self-Sufficient" },
  { number: 89, arabic: "Ÿ±ŸÑŸíŸÖŸèÿ∫ŸíŸÜŸêŸä", transliteration: "Al-Mughni", meaning: "The Enricher" },
  { number: 90, arabic: "Ÿ±ŸÑŸíŸÖŸéÿßŸÜŸêÿπŸè", transliteration: "Al-Mani", meaning: "The Preventer" },
  { number: 91, arabic: "Ÿ±ŸÑÿ∂ŸéŸëÿßÿ±ŸèŸë", transliteration: "Ad-Darr", meaning: "The Distresser" },
  { number: 92, arabic: "Ÿ±ŸÑŸÜŸéŸëÿßŸÅŸêÿπŸè", transliteration: "An-Nafi", meaning: "The Propitious" },
  { number: 93, arabic: "Ÿ±ŸÑŸÜŸèŸëŸàÿ±Ÿè", transliteration: "An-Nur", meaning: "The Light" },
  { number: 94, arabic: "Ÿ±ŸÑŸíŸáŸéÿßÿØŸêŸä", transliteration: "Al-Hadi", meaning: "The Guide" },
  { number: 95, arabic: "Ÿ±ŸÑŸíÿ®ŸéÿØŸêŸäÿπŸè", transliteration: "Al-Badi", meaning: "The Incomparable" },
  { number: 96, arabic: "Ÿ±ŸÑŸíÿ®ŸéÿßŸÇŸêŸä", transliteration: "Al-Baqi", meaning: "The Everlasting" },
  { number: 97, arabic: "Ÿ±ŸÑŸíŸàŸéÿßÿ±Ÿêÿ´Ÿè", transliteration: "Al-Warith", meaning: "The Inheritor" },
  { number: 98, arabic: "Ÿ±ŸÑÿ±ŸéŸëÿ¥ŸêŸäÿØŸè", transliteration: "Ar-Rashid", meaning: "The Guide to the Right Path" },
  { number: 99, arabic: "Ÿ±ŸÑÿµŸéŸëÿ®ŸèŸàÿ±Ÿè", transliteration: "As-Sabur", meaning: "The Patient" },
];

const SUNNAH_PRAYERS = [
  { name: "Fajr", fard: 2, sunnahBefore: 2, sunnahAfter: 0, note: "2 Sunnah before Fajr are the most emphasized (Mu'akkadah)" },
  { name: "Dhuhr", fard: 4, sunnahBefore: 4, sunnahAfter: 2, note: "4 Sunnah before + 2 Sunnah after (all Mu'akkadah)" },
  { name: "Asr", fard: 4, sunnahBefore: 4, sunnahAfter: 0, note: "4 optional Sunnah before (Ghair Mu'akkadah)" },
  { name: "Maghrib", fard: 3, sunnahBefore: 0, sunnahAfter: 2, note: "2 Sunnah after Maghrib (Mu'akkadah)" },
  { name: "Isha", fard: 4, sunnahBefore: 0, sunnahAfter: 2, note: "2 Sunnah after + Witr (1 or 3 raka'at)" },
];

const RAMADAN_PHASES = [
  {
    phase: "First 10 Days",
    theme: "ÿ±Ÿéÿ≠ŸíŸÖŸéÿ© ‚Äî Mercy",
    themeAr: "ÿ±Ÿéÿ≠ŸíŸÖŸéÿ©",
    color: "#2DD4A8",
    days: "Days 1‚Äì10",
    duaa: "ŸäŸéÿß ÿ≠ŸéŸäŸèŸë ŸäŸéÿß ŸÇŸéŸäŸèŸëŸàŸÖŸè ÿ®Ÿêÿ±Ÿéÿ≠ŸíŸÖŸéÿ™ŸêŸÉŸé ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸêŸäÿ´Ÿè",
    duaaEn: "O Living, O Sustaining, in Your Mercy I seek relief",
    goals: [
      "Establish consistent prayer routine with all Sunnah prayers",
      "Begin reading 1 Juz of Quran daily",
      "Make duaa for Allah's mercy after every salah",
      "Give daily sadaqah, even if small",
      "Practice patience and control your tongue",
    ],
  },
  {
    phase: "Middle 10 Days",
    theme: "ŸÖŸéÿ∫ŸíŸÅŸêÿ±Ÿéÿ© ‚Äî Forgiveness",
    themeAr: "ŸÖŸéÿ∫ŸíŸÅŸêÿ±Ÿéÿ©",
    color: "#F59E0B",
    days: "Days 11‚Äì20",
    duaa: "ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿè ÿßŸÑŸÑŸéŸëŸáŸé ÿßŸÑŸéŸëÿ∞ŸêŸä ŸÑŸéÿß ÿ•ŸêŸÑŸéŸ∞ŸáŸé ÿ•ŸêŸÑŸéŸëÿß ŸáŸèŸàŸé ÿßŸÑŸíÿ≠ŸéŸäŸèŸë ÿßŸÑŸíŸÇŸéŸäŸèŸëŸàŸÖŸè ŸàŸéÿ£Ÿéÿ™ŸèŸàÿ®Ÿè ÿ•ŸêŸÑŸéŸäŸíŸáŸê",
    duaaEn: "I seek forgiveness from Allah, there is no god but He, the Living, the Sustaining, and I repent to Him",
    goals: [
      "Increase istighfar (seeking forgiveness) ‚Äî aim for 100x daily",
      "Reflect on past sins and sincerely repent",
      "Mend broken relationships and forgive others",
      "Increase Quran reading to 1.5 Juz daily",
      "Pray Tahajjud at least 2 raka'at before Fajr",
    ],
  },
  {
    phase: "Last 10 Days",
    theme: "ŸÜŸéÿ¨Ÿéÿßÿ© ‚Äî Salvation from Hellfire",
    themeAr: "ŸÜŸéÿ¨Ÿéÿßÿ©",
    color: "#EC4899",
    days: "Days 21‚Äì30",
    duaa: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä",
    duaaEn: "O Allah, You are Pardoning and You love to pardon, so pardon me",
    goals: [
      "Search for Laylatul Qadr ‚Äî increase worship on odd nights",
      "Perform I'tikaf if possible (even partial)",
      "Complete the entire Quran before Eid",
      "Make extensive duaa lists and pour your heart out",
      "Give Zakat al-Fitr before Eid prayer",
    ],
  },
];

const DEFAULT_DUAAS = [
  { id: 1, arabic: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ¢ÿ™ŸêŸÜŸéÿß ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÅŸêŸä ÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÇŸêŸÜŸéÿß ÿπŸéÿ∞Ÿéÿßÿ®Ÿé ÿßŸÑŸÜŸéŸëÿßÿ±Ÿê", english: "Our Lord, give us good in this world and good in the Hereafter, and protect us from the torment of the Fire.", reference: "Quran 2:201", tags: ["protection", "daily", "quranic"], bookmarked: true },
  { id: 2, arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸíŸáŸéŸÖŸêŸë ŸàŸéÿßŸÑŸíÿ≠Ÿéÿ≤ŸéŸÜŸê", english: "O Allah, I seek refuge in You from worry and grief.", reference: "Sahih Bukhari", tags: ["anxiety", "protection", "daily"], bookmarked: false },
  { id: 3, arabic: "ÿ±Ÿéÿ®ŸêŸë ÿßÿ¥Ÿíÿ±Ÿéÿ≠Ÿí ŸÑŸêŸä ÿµŸéÿØŸíÿ±ŸêŸä ŸàŸéŸäŸéÿ≥ŸêŸëÿ±Ÿí ŸÑŸêŸä ÿ£ŸéŸÖŸíÿ±ŸêŸä", english: "My Lord, expand for me my chest and ease for me my task.", reference: "Quran 20:25-26", tags: ["ease", "work", "quranic"], bookmarked: true },
  { id: 4, arabic: "ÿ≠Ÿéÿ≥Ÿíÿ®ŸèŸÜŸéÿß ÿßŸÑŸÑŸéŸëŸáŸè ŸàŸéŸÜŸêÿπŸíŸÖŸé ÿßŸÑŸíŸàŸéŸÉŸêŸäŸÑŸè", english: "Sufficient for us is Allah, and He is the best Disposer of affairs.", reference: "Quran 3:173", tags: ["trust", "tawakkul", "quranic"], bookmarked: false },
  { id: 5, arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíÿπŸéÿßŸÅŸêŸäŸéÿ©Ÿé ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ŸàŸéÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê", english: "O Allah, I ask You for well-being in this world and the Hereafter.", reference: "Ibn Majah", tags: ["health", "daily", "wellbeing"], bookmarked: false },
  { id: 6, arabic: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸÑŸéÿß ÿ™Ÿèÿ≤Ÿêÿ∫Ÿí ŸÇŸèŸÑŸèŸàÿ®ŸéŸÜŸéÿß ÿ®ŸéÿπŸíÿØŸé ÿ•Ÿêÿ∞Ÿí ŸáŸéÿØŸéŸäŸíÿ™ŸéŸÜŸéÿß ŸàŸéŸáŸéÿ®Ÿí ŸÑŸéŸÜŸéÿß ŸÖŸêŸÜ ŸÑŸéŸëÿØŸèŸÜŸÉŸé ÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿã", english: "Our Lord, let not our hearts deviate after You have guided us and grant us from Yourself mercy.", reference: "Quran 3:8", tags: ["guidance", "quranic", "heart"], bookmarked: true },
  { id: 7, arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£ŸéÿπŸêŸÜŸêŸëŸä ÿπŸéŸÑŸéŸâ ÿ∞ŸêŸÉŸíÿ±ŸêŸÉŸé ŸàŸéÿ¥ŸèŸÉŸíÿ±ŸêŸÉŸé ŸàŸéÿ≠Ÿèÿ≥ŸíŸÜŸê ÿπŸêÿ®ŸéÿßÿØŸéÿ™ŸêŸÉŸé", english: "O Allah, help me to remember You, to thank You, and to worship You well.", reference: "Abu Dawud", tags: ["worship", "daily", "gratitude"], bookmarked: false },
  { id: 8, arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä", english: "O Allah, You are Pardoning and You love to pardon, so pardon me.", reference: "Tirmidhi", tags: ["forgiveness", "ramadan", "laylatul-qadr"], bookmarked: true },
];

const ALL_TAGS = ["daily", "quranic", "protection", "anxiety", "ease", "work", "trust", "tawakkul", "health", "wellbeing", "guidance", "heart", "worship", "gratitude", "forgiveness", "ramadan", "laylatul-qadr", "morning", "evening", "travel", "family", "patience"];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ZAKAT CONSTANTS (based on Islamic jurisprudence)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Nisab: 85 grams of gold or 595 grams of silver
// Zakat rate: 2.5% of total zakatable wealth exceeding nisab
// Gold price and silver price are approximate ‚Äî user can override
const DEFAULT_GOLD_PRICE_PER_GRAM = 90; // USD approximate
const DEFAULT_SILVER_PRICE_PER_GRAM = 1.05;
const GOLD_NISAB_GRAMS = 85;
const SILVER_NISAB_GRAMS = 595;
const ZAKAT_RATE = 0.025;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STYLES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const styles = `
  @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;400;500;600;700&display=swap');

  :root {
    --bg-primary: #0A0F1C;
    --bg-secondary: #111827;
    --bg-card: #1A2236;
    --bg-card-hover: #1F2A42;
    --border: #2A3654;
    --gold: #D4A843;
    --gold-light: #E8C66A;
    --gold-dim: #B8922F;
    --emerald: #10B981;
    --emerald-light: #34D399;
    --text-primary: #F1F5F9;
    --text-secondary: #94A3B8;
    --text-muted: #64748B;
    --accent-red: #F43F5E;
    --accent-blue: #3B82F6;
    --accent-purple: #A855F7;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Outfit', sans-serif;
  }

  .app-container {
    max-width: 480px;
    margin: 0 auto;
    min-height: 100vh;
    position: relative;
    background: var(--bg-primary);
    overflow-x: hidden;
  }

  /* Header */
  .app-header {
    padding: 20px 20px 16px;
    text-align: center;
    position: relative;
    background: linear-gradient(180deg, #111D35 0%, var(--bg-primary) 100%);
  }
  .app-header::before {
    content: 'Ô∑Ω';
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'Amiri', serif;
    font-size: 14px;
    color: var(--gold-dim);
    opacity: 0.6;
  }
  .app-title {
    font-family: 'Outfit', sans-serif;
    font-size: 22px;
    font-weight: 700;
    color: var(--gold);
    margin-top: 18px;
    letter-spacing: 0.5px;
  }
  .app-subtitle {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 2px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  /* Geometric pattern */
  .geo-pattern {
    height: 3px;
    background: repeating-linear-gradient(
      90deg,
      var(--gold-dim) 0px,
      var(--gold-dim) 8px,
      transparent 8px,
      transparent 16px
    );
    opacity: 0.3;
    margin: 0 20px;
  }

  /* Navigation */
  .nav-bar {
    display: flex;
    gap: 4px;
    padding: 8px 12px;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .nav-bar::-webkit-scrollbar { display: none; }
  .nav-btn {
    flex-shrink: 0;
    padding: 8px 14px;
    border: 1px solid var(--border);
    border-radius: 20px;
    background: transparent;
    color: var(--text-secondary);
    font-family: 'Outfit', sans-serif;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .nav-btn:hover {
    border-color: var(--gold-dim);
    color: var(--gold-light);
  }
  .nav-btn.active {
    background: linear-gradient(135deg, var(--gold-dim), var(--gold));
    color: #0A0F1C;
    border-color: var(--gold);
    font-weight: 600;
  }

  /* Page container */
  .page {
    padding: 16px 20px 100px;
    animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Section titles */
  .section-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
  }
  .section-desc {
    font-size: 13px;
    color: var(--text-muted);
    margin-bottom: 16px;
    line-height: 1.5;
  }

  /* Cards */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    transition: all 0.2s;
  }
  .card:hover { border-color: var(--gold-dim); }

  /* Form inputs */
  .input-group {
    margin-bottom: 12px;
  }
  .input-label {
    display: block;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .input-field {
    width: 100%;
    padding: 10px 14px;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    font-family: 'Outfit', sans-serif;
    font-size: 15px;
    outline: none;
    transition: border-color 0.2s;
  }
  .input-field:focus { border-color: var(--gold); }
  .input-field::placeholder { color: var(--text-muted); }

  /* Buttons */
  .btn-primary {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, var(--gold-dim), var(--gold));
    color: #0A0F1C;
    border: none;
    border-radius: 10px;
    font-family: 'Outfit', sans-serif;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.5px;
  }
  .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }

  .btn-secondary {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-secondary);
    font-family: 'Outfit', sans-serif;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-secondary:hover {
    border-color: var(--gold-dim);
    color: var(--gold-light);
  }
  .btn-secondary.active {
    background: var(--gold-dim);
    color: #0A0F1C;
    border-color: var(--gold);
  }

  /* Arabic text */
  .arabic {
    font-family: 'Amiri', serif;
    direction: rtl;
    text-align: right;
  }

  /* Names grid */
  .names-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }
  .name-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.25s;
    position: relative;
    overflow: hidden;
  }
  .name-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    opacity: 0;
    transition: opacity 0.25s;
  }
  .name-card:hover::before { opacity: 1; }
  .name-card:hover {
    border-color: var(--gold-dim);
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(212, 168, 67, 0.1);
  }
  .name-card.expanded {
    grid-column: 1 / -1;
    background: var(--bg-card-hover);
    border-color: var(--gold);
  }
  .name-number {
    position: absolute;
    top: 6px;
    left: 8px;
    font-size: 10px;
    color: var(--text-muted);
    font-weight: 500;
  }
  .name-arabic {
    font-family: 'Amiri', serif;
    font-size: 24px;
    color: var(--gold);
    margin-bottom: 4px;
    line-height: 1.4;
  }
  .name-translit {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-primary);
  }
  .name-meaning {
    font-size: 11px;
    color: var(--text-secondary);
    margin-top: 2px;
  }

  /* Search */
  .search-box {
    position: relative;
    margin-bottom: 14px;
  }
  .search-box .input-field {
    padding-left: 36px;
  }
  .search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    font-size: 14px;
  }

  /* Zakat result */
  .zakat-result {
    text-align: center;
    padding: 24px;
    background: linear-gradient(135deg, #1A2236, #162030);
    border: 1px solid var(--gold-dim);
    border-radius: 16px;
    margin: 20px 0;
  }
  .zakat-amount {
    font-size: 36px;
    font-weight: 700;
    color: var(--gold);
    margin: 8px 0;
  }
  .zakat-label {
    font-size: 12px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Prayer row */
  .prayer-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 14px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-bottom: 8px;
    transition: all 0.2s;
  }
  .prayer-row:hover { border-color: var(--gold-dim); }
  .prayer-name {
    font-weight: 600;
    font-size: 15px;
    color: var(--text-primary);
    min-width: 70px;
  }
  .prayer-fard {
    font-size: 12px;
    color: var(--emerald);
    background: rgba(16, 185, 129, 0.1);
    padding: 3px 8px;
    border-radius: 6px;
  }
  .prayer-sunnah {
    font-size: 11px;
    color: var(--gold-light);
    text-align: right;
  }

  /* Phase card */
  .phase-card {
    border-radius: 14px;
    padding: 20px;
    margin-bottom: 14px;
    border: 1px solid;
    position: relative;
    overflow: hidden;
  }
  .phase-card::after {
    content: '';
    position: absolute;
    top: 0; right: 0;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    opacity: 0.05;
  }
  .phase-theme {
    font-family: 'Amiri', serif;
    font-size: 28px;
    margin-bottom: 2px;
  }
  .phase-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 4px;
  }
  .phase-days {
    font-size: 12px;
    opacity: 0.7;
    margin-bottom: 12px;
  }
  .phase-duaa {
    font-family: 'Amiri', serif;
    font-size: 16px;
    line-height: 1.8;
    padding: 10px;
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
    text-align: right;
    direction: rtl;
    margin-bottom: 6px;
  }
  .phase-duaa-en {
    font-size: 12px;
    font-style: italic;
    opacity: 0.7;
    margin-bottom: 12px;
  }
  .phase-goals {
    list-style: none;
    padding: 0;
  }
  .phase-goals li {
    font-size: 13px;
    padding: 6px 0;
    padding-left: 20px;
    position: relative;
    opacity: 0.85;
    line-height: 1.4;
  }
  .phase-goals li::before {
    content: '‚óÜ';
    position: absolute;
    left: 0;
    font-size: 8px;
    top: 9px;
  }

  /* Duaa card */
  .duaa-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 10px;
    transition: all 0.2s;
  }
  .duaa-card:hover { border-color: var(--gold-dim); }
  .duaa-arabic {
    font-family: 'Amiri', serif;
    font-size: 20px;
    line-height: 1.8;
    color: var(--gold-light);
    text-align: right;
    direction: rtl;
    margin-bottom: 10px;
  }
  .duaa-english {
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.5;
    margin-bottom: 8px;
  }
  .duaa-ref {
    font-size: 11px;
    color: var(--text-muted);
    font-style: italic;
  }
  .duaa-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--border);
  }
  .duaa-tags {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
  }
  .tag {
    font-size: 10px;
    padding: 3px 8px;
    border-radius: 10px;
    background: rgba(168, 85, 247, 0.15);
    color: var(--accent-purple);
    font-weight: 500;
    text-transform: lowercase;
  }
  .bookmark-btn {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    transition: transform 0.2s;
    padding: 4px;
  }
  .bookmark-btn:hover { transform: scale(1.2); }

  /* Night calc */
  .night-display {
    text-align: center;
    padding: 30px 20px;
    background: linear-gradient(180deg, #0D1525, #162030);
    border: 1px solid var(--border);
    border-radius: 16px;
    margin-bottom: 16px;
    position: relative;
    overflow: hidden;
  }
  .night-display::before {
    content: '‚òΩ';
    position: absolute;
    top: 12px;
    right: 16px;
    font-size: 24px;
    opacity: 0.3;
  }
  .night-time-label {
    font-size: 12px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 4px;
  }
  .night-time {
    font-size: 42px;
    font-weight: 700;
    color: var(--accent-purple);
    letter-spacing: 1px;
  }
  .night-time-sub {
    font-size: 13px;
    color: var(--text-secondary);
    margin-top: 4px;
  }
  .time-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 14px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 6px;
  }
  .time-row-label {
    font-size: 13px;
    color: var(--text-secondary);
  }
  .time-row-value {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
  }

  /* Tags filter */
  .tags-filter {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-bottom: 14px;
  }
  .tag-filter-btn {
    font-size: 11px;
    padding: 5px 12px;
    border-radius: 14px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Outfit', sans-serif;
  }
  .tag-filter-btn:hover { border-color: var(--gold-dim); }
  .tag-filter-btn.active {
    background: rgba(168, 85, 247, 0.2);
    border-color: var(--accent-purple);
    color: var(--accent-purple);
  }

  /* Add duaa form */
  .add-duaa-form {
    background: var(--bg-card);
    border: 1px solid var(--gold-dim);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
  }
  .add-duaa-form textarea {
    width: 100%;
    padding: 10px;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    resize: vertical;
    min-height: 60px;
    outline: none;
    margin-bottom: 8px;
  }
  .add-duaa-form textarea:focus { border-color: var(--gold); }
  .add-duaa-form .arabic-textarea {
    font-family: 'Amiri', serif;
    font-size: 18px;
    direction: rtl;
    text-align: right;
  }

  /* Status/location */
  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    margin-bottom: 14px;
  }
  .status-badge.success {
    background: rgba(16, 185, 129, 0.15);
    color: var(--emerald);
    border: 1px solid rgba(16, 185, 129, 0.3);
  }
  .status-badge.loading {
    background: rgba(59, 130, 246, 0.15);
    color: var(--accent-blue);
    border: 1px solid rgba(59, 130, 246, 0.3);
  }
  .status-badge.error {
    background: rgba(244, 63, 94, 0.15);
    color: var(--accent-red);
    border: 1px solid rgba(244, 63, 94, 0.3);
  }
  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
  }
  .status-badge.loading .status-dot {
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  /* Collapsible */
  .collapsible-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 4px 0;
  }
  .collapsible-header .arrow {
    transition: transform 0.2s;
    color: var(--text-muted);
  }
  .collapsible-header .arrow.open {
    transform: rotate(180deg);
  }

  /* Zakat category headers */
  .zakat-cat {
    font-size: 13px;
    font-weight: 600;
    color: var(--gold);
    margin: 16px 0 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .zakat-cat::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* Info box */
  .info-box {
    background: rgba(59, 130, 246, 0.08);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 10px;
    padding: 12px 14px;
    margin-bottom: 16px;
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.5;
  }
  .info-box strong {
    color: var(--accent-blue);
  }

  /* Toggle */
  .toggle-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  .toggle-label {
    font-size: 13px;
    color: var(--text-secondary);
  }
  .toggle-tabs {
    display: flex;
    gap: 2px;
    background: var(--bg-secondary);
    border-radius: 8px;
    padding: 2px;
  }
  .toggle-tab {
    padding: 6px 14px;
    border: none;
    border-radius: 6px;
    background: transparent;
    color: var(--text-muted);
    font-family: 'Outfit', sans-serif;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .toggle-tab.active {
    background: var(--gold-dim);
    color: #0A0F1C;
    font-weight: 600;
  }

  .divider {
    height: 1px;
    background: var(--border);
    margin: 16px 0;
  }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-muted);
    font-size: 14px;
  }
  .empty-state .icon {
    font-size: 40px;
    margin-bottom: 12px;
    opacity: 0.3;
  }
`;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMPONENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Stable input component ‚Äî defined outside ZakatCalculator to prevent remount on re-render
function ZakatInput({ label, value, onChange, placeholder }) {
  const formatWithCommas = (val) => {
    if (!val) return "";
    const parts = val.split(".");
    parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    return parts.join(".");
  };

  const handleChange = (e) => {
    const raw = e.target.value.replace(/,/g, "");
    const cleaned = raw.replace(/[^0-9.]/g, "");
    const parts = cleaned.split(".");
    const sanitized = parts.length > 2 ? parts[0] + "." + parts.slice(1).join("") : cleaned;
    onChange(sanitized);
  };

  return (
    <div className="input-group">
      <label className="input-label">{label}</label>
      <div style={{ position: "relative" }}>
        <span style={{
          position: "absolute",
          left: 14,
          top: "50%",
          transform: "translateY(-50%)",
          color: value ? "var(--gold)" : "var(--text-muted)",
          fontSize: 15,
          fontFamily: "'Outfit', sans-serif",
          pointerEvents: "none",
        }}>$</span>
        <input
          type="text"
          inputMode="decimal"
          className="input-field"
          style={{ paddingLeft: 28 }}
          placeholder={placeholder || "0.00"}
          value={formatWithCommas(value)}
          onChange={handleChange}
        />
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ ZAKAT CALCULATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function ZakatCalculator() {
  const [nisabType, setNisabType] = useState("gold");
  const [goldPrice, setGoldPrice] = useState(DEFAULT_GOLD_PRICE_PER_GRAM);
  const [silverPrice, setSilverPrice] = useState(DEFAULT_SILVER_PRICE_PER_GRAM);
  const [assets, setAssets] = useState({
    cashOnHand: "",
    checkingAccount: "",
    savingsAccount: "",
    stocks: "",
    mutualFunds: "",
    bonds: "",
    retirementIRA: "",
    retirement401k: "",
    otherRetirement: "",
    goldValue: "",
    goldGrams: "",
    silverValue: "",
    silverGrams: "",
    businessInventory: "",
    rentalIncome: "",
    investmentProperty: "",
    moneyOwedToYou: "",
    otherAssets: "",
    shortTermDebt: "",
    otherLiabilities: "",
  });
  const [showResult, setShowResult] = useState(false);

  const updateAsset = (key, val) => {
    setAssets(prev => ({ ...prev, [key]: val }));
  };

  const parseNum = (v) => parseFloat(v) || 0;

  const totalAssets = 
    parseNum(assets.cashOnHand) +
    parseNum(assets.checkingAccount) +
    parseNum(assets.savingsAccount) +
    parseNum(assets.stocks) +
    parseNum(assets.mutualFunds) +
    parseNum(assets.bonds) +
    parseNum(assets.retirementIRA) +
    parseNum(assets.retirement401k) +
    parseNum(assets.otherRetirement) +
    parseNum(assets.goldValue) +
    parseNum(assets.silverValue) +
    parseNum(assets.businessInventory) +
    parseNum(assets.rentalIncome) +
    parseNum(assets.investmentProperty) +
    parseNum(assets.moneyOwedToYou) +
    parseNum(assets.otherAssets);

  const totalLiabilities = parseNum(assets.shortTermDebt) + parseNum(assets.otherLiabilities);
  const netZakatableWealth = totalAssets - totalLiabilities;

  const nisabValue = nisabType === "gold"
    ? GOLD_NISAB_GRAMS * (parseFloat(goldPrice) || 0)
    : SILVER_NISAB_GRAMS * (parseFloat(silverPrice) || 0);

  const zakatDue = netZakatableWealth >= nisabValue
    ? netZakatableWealth * ZAKAT_RATE
    : 0;

  return (
    <div className="page">
      <div className="section-title">Zakat Calculator</div>
      <div className="section-desc">
        Calculate your obligatory Zakat ‚Äî 2.5% of net wealth held for one lunar year above the Nisab threshold (85g gold or 595g silver).
      </div>

      <div className="info-box">
        <strong>How Zakat Works:</strong> Sum all zakatable assets (cash, savings, investments, gold, silver, business assets, receivables). Subtract immediate debts/liabilities. If the net amount meets or exceeds the Nisab, pay 2.5% of the total net amount. For retirement accounts (401k, IRA), scholars differ ‚Äî many say Zakat is due on the accessible/vested balance. Consult a local scholar for your specific situation.
      </div>

      <div className="card">
        <div className="toggle-row">
          <span className="toggle-label">Nisab Standard</span>
          <div className="toggle-tabs">
            <button className={`toggle-tab ${nisabType === "gold" ? "active" : ""}`} onClick={() => setNisabType("gold")}>Gold (85g)</button>
            <button className={`toggle-tab ${nisabType === "silver" ? "active" : ""}`} onClick={() => setNisabType("silver")}>Silver (595g)</button>
          </div>
        </div>
        <div style={{ display: "flex", gap: 8 }}>
          <div className="input-group" style={{ flex: 1 }}>
            <label className="input-label">Gold $/gram</label>
            <input type="text" inputMode="decimal" className="input-field" value={goldPrice} onChange={e => {
              const v = e.target.value.replace(/[^0-9.]/g, "");
              setGoldPrice(v === "" ? "" : v);
              const grams = parseFloat(assets.goldGrams) || 0;
              if (grams > 0) {
                const val = grams * (parseFloat(v) || 0);
                setAssets(prev => ({ ...prev, goldValue: val > 0 ? val.toFixed(2) : "" }));
              }
            }} onBlur={() => setGoldPrice(parseFloat(goldPrice) || 0)} />
          </div>
          <div className="input-group" style={{ flex: 1 }}>
            <label className="input-label">Silver $/gram</label>
            <input type="text" inputMode="decimal" className="input-field" value={silverPrice} onChange={e => {
              const v = e.target.value.replace(/[^0-9.]/g, "");
              setSilverPrice(v === "" ? "" : v);
              const grams = parseFloat(assets.silverGrams) || 0;
              if (grams > 0) {
                const val = grams * (parseFloat(v) || 0);
                setAssets(prev => ({ ...prev, silverValue: val > 0 ? val.toFixed(2) : "" }));
              }
            }} onBlur={() => setSilverPrice(parseFloat(silverPrice) || 0)} />
          </div>
        </div>
        <div style={{ fontSize: 12, color: "var(--text-muted)", marginTop: 4 }}>
          Nisab threshold: <strong style={{ color: "var(--gold)" }}>${nisabValue.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong>
        </div>
      </div>

      <div className="zakat-cat">üíµ Cash & Savings</div>
      <ZakatInput label="Cash on Hand" value={assets.cashOnHand} onChange={v => updateAsset("cashOnHand", v)} />
      <ZakatInput label="Checking Account" value={assets.checkingAccount} onChange={v => updateAsset("checkingAccount", v)} />
      <ZakatInput label="Savings Account" value={assets.savingsAccount} onChange={v => updateAsset("savingsAccount", v)} />

      <div className="zakat-cat">üìà Investments</div>
      <ZakatInput label="Stocks (current market value)" value={assets.stocks} onChange={v => updateAsset("stocks", v)} />
      <ZakatInput label="Mutual Funds / ETFs" value={assets.mutualFunds} onChange={v => updateAsset("mutualFunds", v)} />
      <ZakatInput label="Bonds / Sukuk" value={assets.bonds} onChange={v => updateAsset("bonds", v)} />

      <div className="zakat-cat">üè¶ Retirement</div>
      <ZakatInput label="IRA (Traditional / Roth)" value={assets.retirementIRA} onChange={v => updateAsset("retirementIRA", v)} />
      <ZakatInput label="401(k) / 403(b)" value={assets.retirement401k} onChange={v => updateAsset("retirement401k", v)} />
      <ZakatInput label="Other Retirement Savings" value={assets.otherRetirement} onChange={v => updateAsset("otherRetirement", v)} />

      <div className="zakat-cat">ü•á Precious Metals</div>
      <div className="input-group">
        <label className="input-label">Gold ‚Äî Grams Owned</label>
        <div style={{ position: "relative" }}>
          <input
            type="text"
            inputMode="decimal"
            className="input-field"
            style={{ paddingRight: 40 }}
            placeholder="0"
            value={assets.goldGrams || ""}
            onChange={e => {
              const raw = e.target.value.replace(/[^0-9.]/g, "");
              const grams = raw;
              const val = (parseFloat(raw) || 0) * (parseFloat(goldPrice) || 0);
              setAssets(prev => ({ ...prev, goldGrams: grams, goldValue: val > 0 ? val.toFixed(2) : "" }));
            }}
          />
          <span style={{ position: "absolute", right: 14, top: "50%", transform: "translateY(-50%)", color: "var(--text-muted)", fontSize: 13, pointerEvents: "none" }}>g</span>
        </div>
        {assets.goldGrams && parseFloat(assets.goldGrams) > 0 && (
          <div style={{ fontSize: 12, color: "var(--gold)", marginTop: 4 }}>
            = ${(parseFloat(assets.goldGrams) * (parseFloat(goldPrice) || 0)).toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ({assets.goldGrams}g √ó ${parseFloat(goldPrice) || 0}/g)
          </div>
        )}
      </div>
      <div className="input-group">
        <label className="input-label">Silver ‚Äî Grams Owned</label>
        <div style={{ position: "relative" }}>
          <input
            type="text"
            inputMode="decimal"
            className="input-field"
            style={{ paddingRight: 40 }}
            placeholder="0"
            value={assets.silverGrams || ""}
            onChange={e => {
              const raw = e.target.value.replace(/[^0-9.]/g, "");
              const grams = raw;
              const val = (parseFloat(raw) || 0) * (parseFloat(silverPrice) || 0);
              setAssets(prev => ({ ...prev, silverGrams: grams, silverValue: val > 0 ? val.toFixed(2) : "" }));
            }}
          />
          <span style={{ position: "absolute", right: 14, top: "50%", transform: "translateY(-50%)", color: "var(--text-muted)", fontSize: 13, pointerEvents: "none" }}>g</span>
        </div>
        {assets.silverGrams && parseFloat(assets.silverGrams) > 0 && (
          <div style={{ fontSize: 12, color: "var(--text-secondary)", marginTop: 4 }}>
            = ${(parseFloat(assets.silverGrams) * (parseFloat(silverPrice) || 0)).toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ({assets.silverGrams}g √ó ${parseFloat(silverPrice) || 0}/g)
          </div>
        )}
      </div>

      <div className="zakat-cat">üè¢ Business & Property</div>
      <ZakatInput label="Business Inventory / Goods" value={assets.businessInventory} onChange={v => updateAsset("businessInventory", v)} />
      <ZakatInput label="Rental Income Saved" value={assets.rentalIncome} onChange={v => updateAsset("rentalIncome", v)} />
      <ZakatInput label="Investment Property (resale value, if for trade)" value={assets.investmentProperty} onChange={v => updateAsset("investmentProperty", v)} />

      <div className="zakat-cat">üìã Other</div>
      <ZakatInput label="Money Owed to You (expected to be repaid)" value={assets.moneyOwedToYou} onChange={v => updateAsset("moneyOwedToYou", v)} />
      <ZakatInput label="Other Zakatable Assets" value={assets.otherAssets} onChange={v => updateAsset("otherAssets", v)} />

      <div className="zakat-cat" style={{ color: "var(--accent-red)" }}>‚ûñ Deductions</div>
      <ZakatInput label="Short-term Debts (due within the year)" value={assets.shortTermDebt} onChange={v => updateAsset("shortTermDebt", v)} />
      <ZakatInput label="Other Immediate Liabilities" value={assets.otherLiabilities} onChange={v => updateAsset("otherLiabilities", v)} />

      <div className="divider" />
      <button className="btn-primary" onClick={() => setShowResult(true)}>Calculate Zakat</button>

      {showResult && (
        <div className="zakat-result" style={{ animation: "fadeIn 0.4s ease" }}>
          <div className="zakat-label">Your Zakat Due</div>
          <div className="zakat-amount">
            ${zakatDue.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
          </div>
          <div style={{ fontSize: 13, color: "var(--text-secondary)", marginTop: 4 }}>
            {netZakatableWealth >= nisabValue
              ? `Net zakatable wealth: $${netZakatableWealth.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })} √ó 2.5%`
              : `Your net wealth ($${netZakatableWealth.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}) is below the Nisab ($${nisabValue.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}). No Zakat is due.`
            }
          </div>
          <div style={{ fontSize: 11, color: "var(--text-muted)", marginTop: 12 }}>
            ‚ö† This is an estimate. Consult a qualified scholar for your specific situation.
          </div>
        </div>
      )}
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ 99 NAMES OF ALLAH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function NamesOfAllah() {
  const [search, setSearch] = useState("");
  const [expanded, setExpanded] = useState(null);

  const filtered = NAMES_OF_ALLAH.filter(n =>
    n.transliteration.toLowerCase().includes(search.toLowerCase()) ||
    n.meaning.toLowerCase().includes(search.toLowerCase()) ||
    n.arabic.includes(search) ||
    String(n.number) === search
  );

  return (
    <div className="page">
      <div className="section-title">99 Names of Allah</div>
      <div className="section-desc">ÿ£Ÿéÿ≥ŸíŸÖŸéÿßÿ°Ÿè Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸê Ÿ±ŸÑŸíÿ≠Ÿèÿ≥ŸíŸÜŸéŸâŸ∞ ‚Äî The Most Beautiful Names</div>

      <div className="search-box">
        <span className="search-icon">üîç</span>
        <input
          type="text"
          className="input-field"
          placeholder="Search by name, meaning, or number..."
          value={search}
          onChange={e => setSearch(e.target.value)}
        />
      </div>

      <div className="names-grid">
        {filtered.map(name => (
          <div
            key={name.number}
            className={`name-card ${expanded === name.number ? "expanded" : ""}`}
            onClick={() => setExpanded(expanded === name.number ? null : name.number)}
          >
            <span className="name-number">{name.number}</span>
            <div className="name-arabic">{name.arabic}</div>
            <div className="name-translit">{name.transliteration}</div>
            <div className="name-meaning">{name.meaning}</div>
          </div>
        ))}
      </div>

      {filtered.length === 0 && (
        <div className="empty-state">
          <div className="icon">üîç</div>
          <div>No names found matching "{search}"</div>
        </div>
      )}
    </div>
  );
}

const NAWAFEL_PRAYERS = [
  {
    name: "Witr",
    arabic: "ŸàŸêÿ™Ÿíÿ±",
    rakaat: "1, 3, 5, 7, or 9",
    time: "After Isha until Fajr",
    status: "Strongly Emphasized (Wajib per Hanafi)",
    description: "The Prophet Ô∑∫ never left Witr, even while traveling. Best prayed as the last prayer of the night. Can be 1 rak'ah, or 3 (with tashahhud only at end), up to 9.",
    color: "#A855F7",
  },
  {
    name: "Tahajjud",
    arabic: "ÿ™ŸéŸáŸéÿ¨ŸèŸëÿØ",
    rakaat: "2 to 12 (in pairs)",
    time: "Last third of the night (after sleeping)",
    status: "Highly Recommended",
    description: "The best voluntary prayer. Prayed in sets of 2 rak'ahs after waking from sleep in the night. Allah descends to the lowest heaven in the last third and answers du'aa.",
    color: "#6366F1",
  },
  {
    name: "Duha (Forenoon)",
    arabic: "ÿ∂Ÿèÿ≠ŸéŸâ",
    rakaat: "2 to 12 (in pairs)",
    time: "15-20 min after sunrise until before Dhuhr",
    status: "Recommended Sunnah",
    description: "Also called Ishraq when prayed right after sunrise. The Prophet Ô∑∫ said: 'In the morning, charity is due on every joint. Two rak'ahs of Duha suffice for that.' (Muslim)",
    color: "#F59E0B",
  },
  {
    name: "Ishraq",
    arabic: "ÿ•Ÿêÿ¥Ÿíÿ±ŸéÿßŸÇ",
    rakaat: "2",
    time: "15-20 min after sunrise",
    status: "Recommended Sunnah",
    description: "Prayed shortly after sunrise. The Prophet Ô∑∫ said: 'Whoever prays Fajr in congregation, then sits remembering Allah until the sun rises, then prays two rak'ahs ‚Äî he gets the reward of Hajj and Umrah.' (Tirmidhi)",
    color: "#F97316",
  },
  {
    name: "Awwabin",
    arabic: "ÿ£ŸéŸàŸéŸëÿßÿ®ŸêŸäŸÜ",
    rakaat: "6 (in pairs)",
    time: "After Maghrib Sunnah",
    status: "Recommended Sunnah",
    description: "Six rak'ahs prayed in pairs after the 2 Sunnah of Maghrib. Some scholars say: 'Whoever prays 6 rak'ahs after Maghrib without speaking ill between them, it is equivalent to 12 years of worship.' (Tirmidhi)",
    color: "#EC4899",
  },
  {
    name: "Tahiyyat al-Masjid",
    arabic: "ÿ™Ÿéÿ≠ŸêŸäŸéŸëÿ©Ÿè ÿßŸÑŸíŸÖŸéÿ≥Ÿíÿ¨ŸêÿØ",
    rakaat: "2",
    time: "Upon entering the masjid",
    status: "Strongly Recommended",
    description: "The Prophet Ô∑∫ said: 'If any of you enters the masjid, let him not sit down until he prays two rak'ahs.' (Bukhari & Muslim). Not to be prayed during forbidden times.",
    color: "#10B981",
  },
  {
    name: "Salat at-Tawbah",
    arabic: "ÿµŸéŸÑŸéÿßÿ©Ÿè ÿßŸÑÿ™ŸéŸëŸàŸíÿ®Ÿéÿ©",
    rakaat: "2",
    time: "Any permissible time",
    status: "Recommended",
    description: "Prayed when repenting from a sin. Perform wudu well, pray 2 rak'ahs, then sincerely ask Allah for forgiveness. Abu Bakr narrated this from the Prophet Ô∑∫. (Abu Dawud, Tirmidhi)",
    color: "#3B82F6",
  },
  {
    name: "Salat al-Istikhara",
    arabic: "ÿµŸéŸÑŸéÿßÿ©Ÿè ÿßŸÑÿßÿ≥Ÿíÿ™ŸêÿÆŸéÿßÿ±Ÿéÿ©",
    rakaat: "2",
    time: "Any permissible time (when facing a decision)",
    status: "Recommended",
    description: "Prayed when seeking Allah's guidance for a decision. Pray 2 rak'ahs of non-obligatory prayer, then recite the Istikhara du'aa with your matter in mind.",
    color: "#14B8A6",
  },
];

// ‚îÄ‚îÄ‚îÄ SALAH TRACKER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function SalahTracker() {
  const [location, setLocation] = useState(null);
  const [locationName, setLocationName] = useState("");
  const [prayerTimes, setPrayerTimes] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [expandedNafl, setExpandedNafl] = useState(null);

  const fetchPrayerTimes = useCallback(async (lat, lng) => {
    setLoading(true);
    setError(null);
    try {
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, "0");
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const yyyy = today.getFullYear();
      const resp = await fetch(
        `https://api.aladhan.com/v1/timings/${dd}-${mm}-${yyyy}?latitude=${lat}&longitude=${lng}&method=2`
      );
      const data = await resp.json();
      if (data.code === 200) {
        setPrayerTimes({
          fajr: data.data.timings.Fajr,
          sunrise: data.data.timings.Sunrise,
          dhuhr: data.data.timings.Dhuhr,
          asr: data.data.timings.Asr,
          maghrib: data.data.timings.Maghrib,
          isha: data.data.timings.Isha,
          date: data.data.date.readable,
          hijri: `${data.data.date.hijri.day} ${data.data.date.hijri.month.en} ${data.data.date.hijri.year}`,
        });
      } else {
        setError("Could not fetch prayer times.");
      }
    } catch {
      setError("Network error. Please check your connection.");
    }
    setLoading(false);
  }, []);

  const requestLocation = () => {
    setLoading(true);
    setError(null);
    if (!navigator.geolocation) {
      setError("Geolocation is not supported by your browser.");
      setLoading(false);
      return;
    }
    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        const { latitude, longitude } = pos.coords;
        setLocation({ lat: latitude, lng: longitude });
        try {
          const geoResp = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`);
          const geoData = await geoResp.json();
          setLocationName(`${geoData.city || geoData.locality || "Unknown"}, ${geoData.countryName || ""}`);
        } catch {
          setLocationName(`${latitude.toFixed(2)}¬∞, ${longitude.toFixed(2)}¬∞`);
        }
        await fetchPrayerTimes(latitude, longitude);
      },
      () => {
        setError("Location access denied. Please enable GPS.");
        setLoading(false);
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  };

  const formatTime = (t) => {
    if (!t) return "--:--";
    const [h, m] = t.split(":").map(Number);
    const ampm = h >= 12 ? "PM" : "AM";
    const h12 = h % 12 || 12;
    return `${h12}:${String(m).padStart(2, "0")} ${ampm}`;
  };

  const prayerIcons = { fajr: "üåÖ", sunrise: "‚òÄÔ∏è", dhuhr: "üå§Ô∏è", asr: "‚õÖ", maghrib: "üåá", isha: "üåô" };

  return (
    <div className="page">
      <div className="section-title">Salah & Prayer Times</div>
      <div className="section-desc">Your daily prayer schedule with Fard, Sunnah, and Nawafel prayers.</div>

      {/* Location & Prayer Times */}
      {!prayerTimes && (
        <button className="btn-primary" onClick={requestLocation} disabled={loading} style={{ marginBottom: 14 }}>
          {loading ? "Detecting Location..." : "üìç Get Prayer Times for My Location"}
        </button>
      )}

      {loading && (
        <div className="status-badge loading"><span className="status-dot" />Fetching prayer times...</div>
      )}
      {error && (
        <div className="status-badge error" style={{ marginBottom: 12 }}><span className="status-dot" />{error}</div>
      )}

      {prayerTimes && (
        <div style={{ marginBottom: 20 }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
            <div>
              {locationName && (
                <div className="status-badge success" style={{ marginBottom: 0 }}>
                  <span className="status-dot" />{locationName}
                </div>
              )}
            </div>
            <button className="btn-secondary" onClick={requestLocation} style={{ fontSize: 11, padding: "5px 10px" }}>üîÑ Refresh</button>
          </div>
          <div style={{ fontSize: 12, color: "var(--text-muted)", marginBottom: 10 }}>
            {prayerTimes.date} ‚Äî {prayerTimes.hijri}
          </div>

          {["fajr", "sunrise", "dhuhr", "asr", "maghrib", "isha"].map(key => {
            const prayer = SUNNAH_PRAYERS.find(p => p.name.toLowerCase() === key);
            return (
              <div key={key} className="prayer-row" style={key === "sunrise" ? { opacity: 0.6 } : {}}>
                <div style={{ display: "flex", alignItems: "center", gap: 8, minWidth: 100 }}>
                  <span style={{ fontSize: 16 }}>{prayerIcons[key]}</span>
                  <div>
                    <div className="prayer-name" style={{ textTransform: "capitalize" }}>{key}</div>
                    <div style={{ fontSize: 16, fontWeight: 700, color: "var(--gold)", marginTop: 1 }}>{formatTime(prayerTimes[key])}</div>
                  </div>
                </div>
                {prayer ? (
                  <div style={{ textAlign: "right" }}>
                    <div className="prayer-fard">{prayer.fard} Fard</div>
                    <div className="prayer-sunnah" style={{ marginTop: 2 }}>
                      {prayer.sunnahBefore > 0 && <div>{prayer.sunnahBefore} Sunnah before</div>}
                      {prayer.sunnahAfter > 0 && <div>{prayer.sunnahAfter} Sunnah after</div>}
                      {prayer.sunnahBefore === 0 && prayer.sunnahAfter === 0 && <div style={{ opacity: 0.5 }}>4 optional before</div>}
                    </div>
                  </div>
                ) : (
                  <div style={{ fontSize: 11, color: "var(--text-muted)" }}>Not a prayer time</div>
                )}
              </div>
            );
          })}

          <div style={{ fontSize: 11, color: "var(--text-muted)", marginTop: 8, lineHeight: 1.5 }}>
            The 12 Sunnah Mu'akkadah: 2 before Fajr, 4 before Dhuhr, 2 after Dhuhr, 2 after Maghrib, 2 after Isha. "Whoever prays 12 rak'ahs during the day and night, a house will be built for him in Paradise." (Muslim)
          </div>
        </div>
      )}

      {!prayerTimes && (
        <div style={{ marginBottom: 20 }}>
          <div style={{ fontSize: 14, fontWeight: 600, color: "var(--gold)", marginBottom: 10 }}>Daily Fard & Sunnah Prayers</div>
          {SUNNAH_PRAYERS.map((p, i) => (
            <div key={i} className="prayer-row">
              <div className="prayer-name">{p.name}</div>
              <div className="prayer-fard">{p.fard} Fard</div>
              <div className="prayer-sunnah">
                {p.sunnahBefore > 0 && <div>{p.sunnahBefore} Sunnah before</div>}
                {p.sunnahAfter > 0 && <div>{p.sunnahAfter} Sunnah after</div>}
                {p.sunnahBefore === 0 && p.sunnahAfter === 0 && <div style={{ opacity: 0.5 }}>4 optional before</div>}
              </div>
            </div>
          ))}
        </div>
      )}

      <div className="divider" />

      {/* Nawafel Prayers */}
      <div style={{ fontSize: 14, fontWeight: 600, color: "var(--gold)", marginBottom: 4 }}>Nawafel (Voluntary) Prayers</div>
      <div className="section-desc" style={{ marginBottom: 14 }}>Additional prayers to draw closer to Allah. Tap any card for details.</div>

      {NAWAFEL_PRAYERS.map((nafl, i) => (
        <div
          key={i}
          className="card"
          style={{
            borderColor: expandedNafl === i ? nafl.color : "var(--border)",
            cursor: "pointer",
            transition: "all 0.25s",
          }}
          onClick={() => setExpandedNafl(expandedNafl === i ? null : i)}
        >
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
            <div style={{ flex: 1 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 4 }}>
                <span style={{ fontSize: 15, fontWeight: 600, color: "var(--text-primary)" }}>{nafl.name}</span>
                <span style={{ fontFamily: "'Amiri', serif", fontSize: 16, color: nafl.color }}>{nafl.arabic}</span>
              </div>
              <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
                <span style={{
                  fontSize: 10, padding: "2px 8px", borderRadius: 6,
                  background: `${nafl.color}20`, color: nafl.color, fontWeight: 500,
                }}>{nafl.rakaat} rak'ahs</span>
                <span style={{
                  fontSize: 10, padding: "2px 8px", borderRadius: 6,
                  background: "rgba(255,255,255,0.05)", color: "var(--text-secondary)",
                }}>{nafl.time}</span>
              </div>
            </div>
            <span className={`arrow ${expandedNafl === i ? "open" : ""}`} style={{
              fontSize: 12, color: "var(--text-muted)", transition: "transform 0.2s",
              transform: expandedNafl === i ? "rotate(180deg)" : "rotate(0deg)",
            }}>‚ñº</span>
          </div>

          {expandedNafl === i && (
            <div style={{ marginTop: 12, animation: "fadeIn 0.3s ease" }}>
              <div style={{
                fontSize: 10, fontWeight: 600, color: nafl.color,
                textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 4,
              }}>{nafl.status}</div>
              <div style={{ fontSize: 13, color: "var(--text-secondary)", lineHeight: 1.6 }}>
                {nafl.description}
              </div>
            </div>
          )}
        </div>
      ))}

      <div className="info-box" style={{ marginTop: 8 }}>
        <strong>Forbidden prayer times:</strong> Do not pray voluntary prayers during sunrise, when the sun is at its zenith (just before Dhuhr), and during sunset. Obligatory prayers and prayers with a specific reason (like Tahiyyat al-Masjid) are excluded from this restriction by many scholars.
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ RAMADAN TRACKER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function AllChallenges({ challenges, checkedChallenges, setCheckedChallenges, ramadanDay }) {
  const [expanded, setExpanded] = useState(false);
  const completedCount = challenges.filter(c => checkedChallenges[c.day]).length;

  return (
    <div className="card" style={{ borderColor: expanded ? "var(--emerald)" : "var(--border)", padding: expanded ? 16 : 14 }}>
      <div className="collapsible-header" onClick={() => setExpanded(!expanded)}>
        <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
          <span style={{ fontSize: 14 }}>üìã</span>
          <div>
            <span style={{ fontSize: 13, fontWeight: 600, color: "var(--emerald)" }}>30-Day Challenge Calendar</span>
            <div style={{ fontSize: 11, color: "var(--text-muted)" }}>{completedCount}/30 completed</div>
          </div>
        </div>
        <span style={{ fontSize: 12, color: "var(--text-muted)", transition: "transform 0.2s", transform: expanded ? "rotate(180deg)" : "rotate(0deg)" }}>‚ñº</span>
      </div>
      {expanded && (
        <div style={{ marginTop: 14, animation: "fadeIn 0.3s ease" }}>
          {/* Mini progress */}
          <div style={{ height: 6, background: "var(--border)", borderRadius: 3, overflow: "hidden", marginBottom: 14 }}>
            <div style={{ height: "100%", borderRadius: 3, width: `${(completedCount / 30) * 100}%`, background: "var(--emerald)", transition: "width 0.3s ease" }} />
          </div>
          {challenges.map((c) => (
            <div
              key={c.day}
              style={{
                display: "flex", gap: 10, padding: "10px 0",
                borderBottom: c.day < 30 ? "1px solid var(--border)" : "none",
                opacity: checkedChallenges[c.day] ? 0.5 : 1,
              }}
            >
              <button
                onClick={(e) => { e.stopPropagation(); setCheckedChallenges(prev => ({ ...prev, [c.day]: !prev[c.day] })); }}
                style={{
                  flexShrink: 0, width: 22, height: 22, borderRadius: 5, marginTop: 1,
                  background: checkedChallenges[c.day] ? "var(--emerald)" : "transparent",
                  border: `2px solid ${checkedChallenges[c.day] ? "var(--emerald)" : "var(--border)"}`,
                  cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center",
                  color: "#fff", fontSize: 11, transition: "all 0.2s",
                }}
              >
                {checkedChallenges[c.day] ? "‚úì" : ""}
              </button>
              <div style={{ flex: 1 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 6, marginBottom: 2 }}>
                  <span style={{
                    fontSize: 11, fontWeight: 600,
                    color: ramadanDay === c.day ? "var(--gold)" : "var(--text-secondary)",
                  }}>
                    Day {c.day}
                  </span>
                  <span style={{ fontSize: 12 }}>{CHALLENGE_ICONS[c.category]}</span>
                  {ramadanDay === c.day && <span style={{ fontSize: 9, color: "var(--gold)", background: "rgba(212,168,67,0.15)", padding: "1px 6px", borderRadius: 4, fontWeight: 600 }}>TODAY</span>}
                </div>
                <div style={{
                  fontSize: 12, color: "var(--text-secondary)", lineHeight: 1.5,
                  textDecoration: checkedChallenges[c.day] ? "line-through" : "none",
                }}>
                  {c.deed}
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// Ramadan 2026 is expected ~Feb 17 to ~Mar 19, 2026 (1 Ramadan ‚Äì 30 Ramadan 1447 AH)
// We'll use the Aladhan API to get the actual Hijri date dynamically

const DAILY_CHALLENGES = [
  { day: 1, deed: "Set your Ramadan intentions (niyyah) and write down 3 du'aas you want answered this month.", category: "reflection" },
  { day: 2, deed: "Donate to a food bank or prepare an iftar meal for someone in need.", category: "charity" },
  { day: 3, deed: "Memorize a new short surah or 3 new ayahs from the Quran.", category: "quran" },
  { day: 4, deed: "Reach out to a family member you haven't spoken to in a while.", category: "family" },
  { day: 5, deed: "Pray all 5 prayers at their earliest time today with full khushu'.", category: "salah" },
  { day: 6, deed: "Give a genuine compliment to 5 different people today.", category: "kindness" },
  { day: 7, deed: "Read the translation and tafsir of Surah Al-Mulk (67).", category: "quran" },
  { day: 8, deed: "Fast with your tongue ‚Äî avoid backbiting, gossip, and harsh words all day.", category: "character" },
  { day: 9, deed: "Sponsor an orphan's meal or donate to an orphan fund.", category: "charity" },
  { day: 10, deed: "Make du'aa for 10 people by name ‚Äî friends, family, and the Ummah.", category: "duaa" },
  { day: 11, deed: "Say Astaghfirullah 100 times throughout the day, seeking deep forgiveness.", category: "dhikr" },
  { day: 12, deed: "Visit or call someone who is sick, elderly, or lonely.", category: "kindness" },
  { day: 13, deed: "Give charity anonymously ‚Äî let no one know except Allah.", category: "charity" },
  { day: 14, deed: "Read and reflect on the story of a Prophet from the Quran.", category: "quran" },
  { day: 15, deed: "Forgive someone who has wronged you, even if they haven't apologized.", category: "character" },
  { day: 16, deed: "Pray Tahajjud tonight ‚Äî even just 2 rak'ahs before Fajr.", category: "salah" },
  { day: 17, deed: "Teach a child or new Muslim something about Islam today.", category: "dawah" },
  { day: 18, deed: "Do an extra act of service ‚Äî help a neighbor, volunteer, or clean a masjid.", category: "kindness" },
  { day: 19, deed: "Write a heartfelt letter of gratitude to your parents or a mentor.", category: "family" },
  { day: 20, deed: "Review your Ramadan goals ‚Äî recommit to what you've fallen behind on.", category: "reflection" },
  { day: 21, deed: "Search for Laylatul Qadr tonight ‚Äî spend the night in worship, du'aa, and Quran.", category: "salah" },
  { day: 22, deed: "Pay your Zakat or a portion of it today.", category: "charity" },
  { day: 23, deed: "Make an extensive du'aa list and pour your heart out to Allah tonight (odd night).", category: "duaa" },
  { day: 24, deed: "Share the message of Islam with a non-Muslim through kindness and conversation.", category: "dawah" },
  { day: 25, deed: "Pray every nafl prayer you can today ‚Äî Ishraq, Duha, Awwabin, Tahajjud (odd night).", category: "salah" },
  { day: 26, deed: "Donate generously today ‚Äî the Prophet Ô∑∫ was most generous in Ramadan.", category: "charity" },
  { day: 27, deed: "The most likely night for Laylatul Qadr ‚Äî worship as if this is the night! Recite ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸÉ ÿπŸÅŸà ÿ™ÿ≠ÿ® ÿßŸÑÿπŸÅŸà ŸÅÿßÿπŸÅ ÿπŸÜŸä.", category: "salah" },
  { day: 28, deed: "Reflect on what you've learned this Ramadan. What habits will you keep?", category: "reflection" },
  { day: 29, deed: "Pay Zakat al-Fitr before Eid. Prepare for Eid with gratitude.", category: "charity" },
  { day: 30, deed: "End Ramadan with deep gratitude, istighfar, and du'aa to accept your fasting and worship.", category: "reflection" },
];

const CHALLENGE_ICONS = {
  charity: "üíù",
  quran: "üìñ",
  salah: "üïå",
  kindness: "ü§ù",
  character: "‚ú®",
  duaa: "ü§≤",
  dhikr: "üìø",
  family: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
  reflection: "ü™û",
  dawah: "üåç",
};

function RamadanTracker() {
  const [activePhase, setActivePhase] = useState(0);
  const [checkedGoals, setCheckedGoals] = useState({});
  const [checkedChallenges, setCheckedChallenges] = useState({});
  const [prayerTimes, setPrayerTimes] = useState(null);
  const [locationName, setLocationName] = useState("");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [ramadanDay, setRamadanDay] = useState(null);
  const [hijriDate, setHijriDate] = useState("");

  const toggleGoal = (phaseIdx, goalIdx) => {
    const key = `${phaseIdx}-${goalIdx}`;
    setCheckedGoals(prev => ({ ...prev, [key]: !prev[key] }));
  };

  const fetchTimes = useCallback(async (lat, lng) => {
    setLoading(true);
    setError(null);
    try {
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, "0");
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const yyyy = today.getFullYear();

      // Today's times
      const resp = await fetch(
        `https://api.aladhan.com/v1/timings/${dd}-${mm}-${yyyy}?latitude=${lat}&longitude=${lng}&method=2`
      );
      const data = await resp.json();

      // Tomorrow for Fajr (suhoor)
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      const dd2 = String(tomorrow.getDate()).padStart(2, "0");
      const mm2 = String(tomorrow.getMonth() + 1).padStart(2, "0");
      const yyyy2 = tomorrow.getFullYear();
      const resp2 = await fetch(
        `https://api.aladhan.com/v1/timings/${dd2}-${mm2}-${yyyy2}?latitude=${lat}&longitude=${lng}&method=2`
      );
      const data2 = await resp2.json();

      if (data.code === 200 && data2.code === 200) {
        setPrayerTimes({
          fajr: data.data.timings.Fajr,
          maghrib: data.data.timings.Maghrib,
          sunrise: data.data.timings.Sunrise,
          fajrTomorrow: data2.data.timings.Fajr,
        });

        // Check Hijri date for Ramadan
        const hijri = data.data.date.hijri;
        setHijriDate(`${hijri.day} ${hijri.month.en} ${hijri.year} AH`);
        if (hijri.month.number === 9) {
          setRamadanDay(parseInt(hijri.day));
          const day = parseInt(hijri.day);
          if (day <= 10) setActivePhase(0);
          else if (day <= 20) setActivePhase(1);
          else setActivePhase(2);
        } else {
          setRamadanDay(null);
        }
      } else {
        setError("Could not fetch prayer times.");
      }
    } catch {
      setError("Network error. Check your connection.");
    }
    setLoading(false);
  }, []);

  const requestLocation = () => {
    setLoading(true);
    setError(null);
    if (!navigator.geolocation) {
      setError("Geolocation not supported.");
      setLoading(false);
      return;
    }
    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        const { latitude, longitude } = pos.coords;
        try {
          const geoResp = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`);
          const geoData = await geoResp.json();
          setLocationName(`${geoData.city || geoData.locality || "Unknown"}, ${geoData.countryName || ""}`);
        } catch {
          setLocationName(`${latitude.toFixed(2)}¬∞, ${longitude.toFixed(2)}¬∞`);
        }
        await fetchTimes(latitude, longitude);
      },
      () => {
        setError("Location access denied. Enable GPS and try again.");
        setLoading(false);
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  };

  const formatTime = (t) => {
    if (!t) return "--:--";
    const [h, m] = t.split(":").map(Number);
    const ampm = h >= 12 ? "PM" : "AM";
    const h12 = h % 12 || 12;
    return `${h12}:${String(m).padStart(2, "0")} ${ampm}`;
  };

  // Fasting duration
  const getFastingDuration = () => {
    if (!prayerTimes) return null;
    const [fH, fM] = prayerTimes.fajr.split(":").map(Number);
    const [mH, mM] = prayerTimes.maghrib.split(":").map(Number);
    const fajrMin = fH * 60 + fM;
    const maghribMin = mH * 60 + mM;
    const dur = maghribMin - fajrMin;
    return { hours: Math.floor(dur / 60), minutes: dur % 60 };
  };

  const fastingDur = getFastingDuration();
  const currentChallenge = ramadanDay ? DAILY_CHALLENGES.find(c => c.day === ramadanDay) : null;

  // Preview mode: if not Ramadan, show day 1 as a demo
  const previewDay = ramadanDay || 1;
  const previewChallenge = DAILY_CHALLENGES.find(c => c.day === previewDay);

  return (
    <div className="page">
      <div className="section-title">Ramadan Companion</div>
      <div className="section-desc">Your daily Ramadan schedule, iftar & suhoor times, and spiritual goals.</div>

      {/* GPS / Schedule section */}
      {!prayerTimes && (
        <button className="btn-primary" onClick={requestLocation} disabled={loading} style={{ marginBottom: 14 }}>
          {loading ? "Detecting Location..." : "üìç Get Today's Ramadan Schedule"}
        </button>
      )}
      {loading && <div className="status-badge loading"><span className="status-dot" />Loading...</div>}
      {error && <div className="status-badge error" style={{ marginBottom: 12 }}><span className="status-dot" />{error}</div>}

      {prayerTimes && (
        <div style={{ marginBottom: 20, animation: "fadeIn 0.3s ease" }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 8 }}>
            {locationName && (
              <div className="status-badge success" style={{ marginBottom: 0 }}><span className="status-dot" />{locationName}</div>
            )}
            <button className="btn-secondary" onClick={requestLocation} style={{ fontSize: 11, padding: "5px 10px" }}>üîÑ</button>
          </div>

          <div style={{ fontSize: 12, color: "var(--text-muted)", marginBottom: 12 }}>{hijriDate}</div>

          {/* Ramadan day hero */}
          {ramadanDay ? (
            <div style={{
              textAlign: "center", padding: "20px 16px", marginBottom: 14,
              background: "linear-gradient(135deg, rgba(212, 168, 67, 0.12), rgba(212, 168, 67, 0.04))",
              border: "1px solid rgba(212, 168, 67, 0.25)", borderRadius: 14,
            }}>
              <div style={{ fontSize: 11, color: "var(--gold-dim)", textTransform: "uppercase", letterSpacing: 1.5 }}>Ramadan Day</div>
              <div style={{ fontSize: 48, fontWeight: 700, color: "var(--gold)", lineHeight: 1.1 }}>{ramadanDay}</div>
              <div style={{ fontSize: 12, color: "var(--text-muted)", marginTop: 2 }}>
                of 30 ‚Äî {ramadanDay <= 10 ? "Days of Mercy" : ramadanDay <= 20 ? "Days of Forgiveness" : "Days of Salvation"}
              </div>
              {/* Progress bar */}
              <div style={{ marginTop: 12, height: 6, background: "var(--border)", borderRadius: 3, overflow: "hidden" }}>
                <div style={{
                  height: "100%", borderRadius: 3, transition: "width 0.5s ease",
                  width: `${(ramadanDay / 30) * 100}%`,
                  background: ramadanDay <= 10 ? "#2DD4A8" : ramadanDay <= 20 ? "#F59E0B" : "#EC4899",
                }} />
              </div>
              <div style={{ fontSize: 10, color: "var(--text-muted)", marginTop: 4 }}>
                {30 - ramadanDay} days remaining
              </div>
            </div>
          ) : (
            <div style={{
              textAlign: "center", padding: "16px", marginBottom: 14,
              background: "var(--bg-card)", border: "1px solid var(--border)", borderRadius: 12,
            }}>
              <div style={{ fontSize: 13, color: "var(--text-secondary)" }}>
                It is not currently Ramadan. Showing preview times & schedule below.
              </div>
              <div style={{ fontSize: 11, color: "var(--text-muted)", marginTop: 4 }}>
                Ramadan 1447 AH is expected around Feb‚ÄìMar 2026
              </div>
            </div>
          )}

          {/* Iftar & Suhoor cards */}
          <div style={{ display: "flex", gap: 8, marginBottom: 14 }}>
            <div style={{
              flex: 1, textAlign: "center", padding: "16px 12px", borderRadius: 12,
              background: "linear-gradient(135deg, rgba(212, 168, 67, 0.12), rgba(212, 168, 67, 0.04))",
              border: "1px solid rgba(212, 168, 67, 0.3)",
            }}>
              <div style={{ fontSize: 10, color: "var(--gold-dim)", letterSpacing: 1.5, textTransform: "uppercase" }}>Iftar</div>
              <div style={{ fontFamily: "'Amiri', serif", fontSize: 14, color: "var(--gold)", marginTop: 2 }}>ÿ•ŸÅÿ∑ÿßÿ±</div>
              <div style={{ fontSize: 28, fontWeight: 700, color: "var(--gold)", marginTop: 4 }}>{formatTime(prayerTimes.maghrib)}</div>
              <div style={{ fontSize: 11, color: "var(--text-muted)", marginTop: 2 }}>at Maghrib</div>
            </div>
            <div style={{
              flex: 1, textAlign: "center", padding: "16px 12px", borderRadius: 12,
              background: "linear-gradient(135deg, rgba(168, 85, 247, 0.12), rgba(168, 85, 247, 0.04))",
              border: "1px solid rgba(168, 85, 247, 0.3)",
            }}>
              <div style={{ fontSize: 10, color: "var(--accent-purple)", letterSpacing: 1.5, textTransform: "uppercase" }}>Suhoor Ends</div>
              <div style={{ fontFamily: "'Amiri', serif", fontSize: 14, color: "var(--accent-purple)", marginTop: 2 }}>ÿ≥ÿ≠Ÿàÿ±</div>
              <div style={{ fontSize: 28, fontWeight: 700, color: "var(--accent-purple)", marginTop: 4 }}>{formatTime(prayerTimes.fajrTomorrow)}</div>
              <div style={{ fontSize: 11, color: "var(--text-muted)", marginTop: 2 }}>before Fajr (tomorrow)</div>
            </div>
          </div>

          {/* Fasting duration */}
          {fastingDur && (
            <div className="time-row" style={{ marginBottom: 14 }}>
              <span className="time-row-label">Today's Fasting Duration</span>
              <span className="time-row-value" style={{ color: "var(--emerald)" }}>
                ~{fastingDur.hours}h {fastingDur.minutes}m
              </span>
            </div>
          )}
        </div>
      )}

      {/* Daily Good Deed Challenge */}
      <div style={{
        marginBottom: 16, padding: "16px", borderRadius: 14,
        background: "linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.03))",
        border: "1px solid rgba(16, 185, 129, 0.25)",
      }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 10 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
            <span style={{ fontSize: 18 }}>{CHALLENGE_ICONS[previewChallenge?.category] || "‚ú®"}</span>
            <div>
              <div style={{ fontSize: 10, color: "var(--emerald)", textTransform: "uppercase", letterSpacing: 1 }}>
                {ramadanDay ? "Today's Good Deed" : "Daily Challenge Preview ‚Äî Day 1"}
              </div>
              <div style={{ fontSize: 10, color: "var(--text-muted)", textTransform: "capitalize", marginTop: 1 }}>
                {previewChallenge?.category}
              </div>
            </div>
          </div>
          {ramadanDay && (
            <button
              onClick={() => setCheckedChallenges(prev => ({ ...prev, [previewDay]: !prev[previewDay] }))}
              style={{
                background: checkedChallenges[previewDay] ? "var(--emerald)" : "transparent",
                border: `2px solid ${checkedChallenges[previewDay] ? "var(--emerald)" : "var(--border)"}`,
                borderRadius: 6, width: 26, height: 26, cursor: "pointer",
                display: "flex", alignItems: "center", justifyContent: "center",
                color: "#fff", fontSize: 14, transition: "all 0.2s",
              }}
            >
              {checkedChallenges[previewDay] ? "‚úì" : ""}
            </button>
          )}
        </div>
        <div style={{
          fontSize: 14, color: "var(--text-primary)", lineHeight: 1.6,
          textDecoration: checkedChallenges[previewDay] ? "line-through" : "none",
          opacity: checkedChallenges[previewDay] ? 0.6 : 1,
        }}>
          {previewChallenge?.deed}
        </div>
      </div>

      {/* All 30 Day Challenges (collapsed) */}
      <AllChallenges
        challenges={DAILY_CHALLENGES}
        checkedChallenges={checkedChallenges}
        setCheckedChallenges={setCheckedChallenges}
        ramadanDay={ramadanDay}
      />

      <div className="divider" />

      {/* Ramadan Phases */}
      <div style={{ fontSize: 14, fontWeight: 600, color: "var(--gold)", marginBottom: 10 }}>Three Phases of Ramadan</div>

      <div style={{ display: "flex", gap: 6, marginBottom: 14 }}>
        {RAMADAN_PHASES.map((phase, i) => (
          <button
            key={i}
            className={`btn-secondary ${activePhase === i ? "active" : ""}`}
            style={activePhase === i ? { background: phase.color, borderColor: phase.color, color: "#0A0F1C" } : {}}
            onClick={() => setActivePhase(i)}
          >
            {phase.days}
          </button>
        ))}
      </div>

      {RAMADAN_PHASES.map((phase, phaseIdx) => (
        phaseIdx === activePhase && (
          <div
            key={phaseIdx}
            className="phase-card"
            style={{
              background: `linear-gradient(135deg, ${phase.color}15, ${phase.color}08)`,
              borderColor: `${phase.color}40`,
              color: phase.color,
            }}
          >
            <div className="phase-theme">{phase.themeAr}</div>
            <div className="phase-title" style={{ color: "var(--text-primary)" }}>{phase.theme}</div>
            <div className="phase-days">{phase.days}</div>
            <div className="phase-duaa">{phase.duaa}</div>
            <div className="phase-duaa-en">{phase.duaaEn}</div>

            <div style={{ fontSize: 12, fontWeight: 600, color: "var(--text-primary)", marginBottom: 8 }}>Goals & Actions</div>
            <ul className="phase-goals">
              {phase.goals.map((goal, goalIdx) => {
                const key = `${phaseIdx}-${goalIdx}`;
                return (
                  <li
                    key={goalIdx}
                    style={{
                      color: checkedGoals[key] ? phase.color : "var(--text-secondary)",
                      textDecoration: checkedGoals[key] ? "line-through" : "none",
                      cursor: "pointer",
                    }}
                    onClick={() => toggleGoal(phaseIdx, goalIdx)}
                  >
                    {goal}
                  </li>
                );
              })}
            </ul>
          </div>
        )
      ))}

      <div className="info-box" style={{ marginTop: 12 }}>
        <strong>Taraweeh:</strong> 8 or 20 rak'ahs (scholars differ) prayed after Isha during Ramadan. End with Witr (1 or 3 rak'ahs). Increase Quran recitation and duaa, especially in the last 10 nights seeking Laylatul Qadr.
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ DUAA JOURNAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function DuaaJournal() {
  const [duaas, setDuaas] = useState(DEFAULT_DUAAS);
  const [filter, setFilter] = useState("all");
  const [tagFilter, setTagFilter] = useState(null);
  const [showForm, setShowForm] = useState(false);
  const [newDuaa, setNewDuaa] = useState({ arabic: "", english: "", reference: "", tags: [] });

  const toggleBookmark = (id) => {
    setDuaas(prev => prev.map(d => d.id === id ? { ...d, bookmarked: !d.bookmarked } : d));
  };

  const addDuaa = () => {
    if (!newDuaa.english.trim()) return;
    const duaa = {
      id: Date.now(),
      arabic: newDuaa.arabic,
      english: newDuaa.english,
      reference: newDuaa.reference || "Personal",
      tags: newDuaa.tags,
      bookmarked: true,
    };
    setDuaas(prev => [duaa, ...prev]);
    setNewDuaa({ arabic: "", english: "", reference: "", tags: [] });
    setShowForm(false);
  };

  const toggleNewTag = (tag) => {
    setNewDuaa(prev => ({
      ...prev,
      tags: prev.tags.includes(tag)
        ? prev.tags.filter(t => t !== tag)
        : [...prev.tags, tag]
    }));
  };

  const filtered = duaas.filter(d => {
    if (filter === "bookmarked" && !d.bookmarked) return false;
    if (tagFilter && !d.tags.includes(tagFilter)) return false;
    return true;
  });

  const usedTags = [...new Set(duaas.flatMap(d => d.tags))].sort();

  const [showEtiquette, setShowEtiquette] = useState(true);
  const [showBestTimes, setShowBestTimes] = useState(false);

  const duaaSteps = [
    { step: 1, label: "Praise Allah", arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸ∞ŸáŸê ÿ±Ÿéÿ®ŸêŸë Ÿ±ŸÑŸíÿπŸéÿßŸÑŸéŸÖŸêŸäŸÜŸé", desc: "Begin by praising and glorifying Allah with His beautiful names and attributes." },
    { step: 2, label: "Send Salawat upon the Prophet Ô∑∫", arabic: "Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâŸ∞ ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ŸàŸéÿπŸéŸÑŸéŸâŸ∞ ÿ¢ŸÑŸê ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç", desc: "The Prophet Ô∑∫ said: 'Every du'aa is suspended between heaven and earth until you send blessings upon your Prophet.' (Tirmidhi)" },
    { step: 3, label: "Seek Forgiveness", arabic: "ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿè Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸé ÿßŸÑŸíÿπŸéÿ∏ŸêŸäŸÖŸé ŸàŸéÿ£Ÿéÿ™ŸèŸàÿ®Ÿè ÿ•ŸêŸÑŸéŸäŸíŸáŸê", desc: "Acknowledge your shortcomings and repent sincerely before asking." },
    { step: 4, label: "Make Your Du'aa", arabic: "ÿ±Ÿéÿ®ŸêŸë...", desc: "Ask Allah with sincerity, conviction, humility, and urgency. Be specific. Ask with certainty that He will respond. Cry if you can." },
    { step: 5, label: "Send Salawat upon the Prophet Ô∑∫", arabic: "Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâŸ∞ ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ŸàŸéÿπŸéŸÑŸéŸâŸ∞ ÿ¢ŸÑŸê ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç", desc: "Seal your du'aa by sending blessings upon the Prophet Ô∑∫ again, bookending your supplication." },
    { step: 6, label: "Thank & Praise Allah", arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸ∞ŸáŸê ÿ±Ÿéÿ®ŸêŸë Ÿ±ŸÑŸíÿπŸéÿßŸÑŸéŸÖŸêŸäŸÜŸé", desc: "End with gratitude and praise, trusting that Allah has heard you and will respond in the best way." },
  ];

  const bestTimes = [
    { time: "The Last Third of the Night", icon: "üåô", detail: "Allah descends to the lowest heaven and says: 'Who is calling upon Me that I may answer?' (Bukhari & Muslim)", tier: "gold" },
    { time: "Between the Adhan and Iqamah", icon: "üïå", detail: "The Prophet Ô∑∫ said: 'Du'aa between the adhan and iqamah is not rejected.' (Abu Dawud, Tirmidhi)", tier: "gold" },
    { time: "During Sujood (Prostration)", icon: "ü§≤", detail: "'The closest a servant is to his Lord is when he is in prostration, so increase du'aa therein.' (Muslim)", tier: "gold" },
    { time: "The Last Hour of Friday", icon: "üìÖ", detail: "A blessed hour on Friday (before Maghrib) when du'aa is answered. (Bukhari & Muslim)", tier: "gold" },
    { time: "While Fasting (Before Iftar)", icon: "üåÖ", detail: "'Three du'aas are not rejected: the fasting person until they break their fast‚Ä¶' (Tirmidhi)", tier: "gold" },
    { time: "Laylatul Qadr", icon: "‚ú®", detail: "The Night of Decree in the last 10 nights of Ramadan ‚Äî better than a thousand months. (Quran 97:3)", tier: "gold" },
    { time: "During Rain", icon: "üåßÔ∏è", detail: "'Two du'aas are not rejected: du'aa at the time of the call to prayer and du'aa at the time of rain.' (Al-Hakim)", tier: "silver" },
    { time: "After the Obligatory Prayers", icon: "üïã", detail: "The Prophet Ô∑∫ was asked: 'Which du'aa is most heard?' He said: 'In the last part of the night and after the obligatory prayers.' (Tirmidhi)", tier: "silver" },
    { time: "While Traveling", icon: "‚úàÔ∏è", detail: "'Three du'aas are answered without doubt: the du'aa of the oppressed, the traveler, and the parent for their child.' (Tirmidhi)", tier: "silver" },
    { time: "When Visiting the Sick", icon: "üíö", detail: "The angels say 'Ameen' to the du'aa of the one visiting the sick. (Muslim)", tier: "silver" },
    { time: "After Reciting Quran", icon: "üìñ", detail: "The one who recites Quran sincerely is in a state of worship, and du'aa in a state of worship is beloved to Allah.", tier: "silver" },
    { time: "On the Day of Arafah", icon: "‚õ∞Ô∏è", detail: "'The best du'aa is the du'aa on the Day of Arafah.' (Tirmidhi)", tier: "silver" },
  ];

  return (
    <div className="page">
      <div className="section-title">Du'aa Journal</div>
      <div className="section-desc">Your personal collection of supplications. Bookmark favorites and organize by tags.</div>

      {/* Etiquette of Du'aa */}
      <div className="card" style={{ borderColor: showEtiquette ? "var(--gold-dim)" : "var(--border)", marginBottom: 12 }}>
        <div className="collapsible-header" onClick={() => setShowEtiquette(!showEtiquette)}>
          <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
            <span style={{ fontSize: 14 }}>ü§≤</span>
            <span style={{ fontSize: 14, fontWeight: 600, color: "var(--gold)" }}>How to Make Du'aa</span>
          </div>
          <span style={{ fontSize: 12, color: "var(--text-muted)", transition: "transform 0.2s", transform: showEtiquette ? "rotate(180deg)" : "rotate(0deg)" }}>‚ñº</span>
        </div>
        {showEtiquette && (
          <div style={{ marginTop: 14, animation: "fadeIn 0.3s ease" }}>
            <div style={{ fontSize: 12, color: "var(--text-secondary)", marginBottom: 14, lineHeight: 1.5 }}>
              Follow these steps to make du'aa in the manner taught by the Prophet Ô∑∫. Face the Qiblah, raise your hands, and call upon Allah with humility and hope.
            </div>
            {duaaSteps.map((s) => (
              <div key={s.step} style={{
                display: "flex",
                gap: 12,
                marginBottom: 14,
                paddingBottom: s.step < 6 ? 14 : 0,
                borderBottom: s.step < 6 ? "1px solid var(--border)" : "none",
              }}>
                <div style={{
                  width: 28, height: 28, borderRadius: "50%",
                  background: s.step === 4 ? "var(--gold)" : "var(--bg-secondary)",
                  border: s.step === 4 ? "none" : "1px solid var(--border)",
                  display: "flex", alignItems: "center", justifyContent: "center",
                  fontSize: 12, fontWeight: 700, flexShrink: 0,
                  color: s.step === 4 ? "#0A0F1C" : "var(--text-muted)",
                }}>
                  {s.step}
                </div>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 13, fontWeight: 600, color: s.step === 4 ? "var(--gold)" : "var(--text-primary)", marginBottom: 2 }}>{s.label}</div>
                  <div style={{ fontFamily: "'Amiri', serif", fontSize: 16, color: s.step === 4 ? "var(--gold-light)" : "var(--gold-dim)", direction: "rtl", textAlign: "right", marginBottom: 4, lineHeight: 1.6 }}>
                    {s.arabic}
                  </div>
                  <div style={{ fontSize: 12, color: "var(--text-muted)", lineHeight: 1.5 }}>{s.desc}</div>
                </div>
              </div>
            ))}
            <div style={{
              marginTop: 8, padding: "10px 12px", borderRadius: 8,
              background: "rgba(212, 168, 67, 0.08)", border: "1px solid rgba(212, 168, 67, 0.15)",
              fontSize: 12, color: "var(--text-secondary)", lineHeight: 1.5,
            }}>
              <strong style={{ color: "var(--gold)" }}>Tips:</strong> Face the Qiblah. Be in a state of wudu. Raise your hands. Be persistent and don't rush. Never say "if You will" ‚Äî ask with conviction. Don't make du'aa against yourself, your family, or your wealth.
            </div>
          </div>
        )}
      </div>

      {/* Best Times for Du'aa */}
      <div className="card" style={{ borderColor: showBestTimes ? "var(--accent-purple)" : "var(--border)", marginBottom: 16 }}>
        <div className="collapsible-header" onClick={() => setShowBestTimes(!showBestTimes)}>
          <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
            <span style={{ fontSize: 14 }}>‚è∞</span>
            <span style={{ fontSize: 14, fontWeight: 600, color: "var(--accent-purple)" }}>Best Times to Make Du'aa</span>
          </div>
          <span style={{ fontSize: 12, color: "var(--text-muted)", transition: "transform 0.2s", transform: showBestTimes ? "rotate(180deg)" : "rotate(0deg)" }}>‚ñº</span>
        </div>
        {showBestTimes && (
          <div style={{ marginTop: 14, animation: "fadeIn 0.3s ease" }}>
            <div style={{ fontSize: 11, fontWeight: 600, color: "var(--gold)", textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 }}>‚ú¶ Most Virtuous Times</div>
            {bestTimes.filter(t => t.tier === "gold").map((t, i) => (
              <div key={i} style={{
                display: "flex", gap: 10, marginBottom: 12,
                padding: "10px 12px", borderRadius: 8,
                background: "rgba(212, 168, 67, 0.05)", border: "1px solid rgba(212, 168, 67, 0.12)",
              }}>
                <span style={{ fontSize: 18, flexShrink: 0, marginTop: 1 }}>{t.icon}</span>
                <div>
                  <div style={{ fontSize: 13, fontWeight: 600, color: "var(--text-primary)", marginBottom: 2 }}>{t.time}</div>
                  <div style={{ fontSize: 11, color: "var(--text-muted)", lineHeight: 1.5 }}>{t.detail}</div>
                </div>
              </div>
            ))}
            <div style={{ fontSize: 11, fontWeight: 600, color: "var(--text-secondary)", textTransform: "uppercase", letterSpacing: 0.5, marginTop: 16, marginBottom: 8 }}>‚ú¶ Other Blessed Times</div>
            {bestTimes.filter(t => t.tier === "silver").map((t, i) => (
              <div key={i} style={{
                display: "flex", gap: 10, marginBottom: 10,
                padding: "8px 12px", borderRadius: 8,
                background: "rgba(255,255,255,0.02)",
              }}>
                <span style={{ fontSize: 16, flexShrink: 0, marginTop: 1 }}>{t.icon}</span>
                <div>
                  <div style={{ fontSize: 13, fontWeight: 500, color: "var(--text-primary)", marginBottom: 2 }}>{t.time}</div>
                  <div style={{ fontSize: 11, color: "var(--text-muted)", lineHeight: 1.5 }}>{t.detail}</div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      <div className="divider" style={{ marginTop: 0 }} />

      <div style={{ display: "flex", gap: 8, marginBottom: 12 }}>
        <button
          className={`btn-secondary ${filter === "all" ? "active" : ""}`}
          onClick={() => setFilter("all")}
        >
          All ({duaas.length})
        </button>
        <button
          className={`btn-secondary ${filter === "bookmarked" ? "active" : ""}`}
          onClick={() => setFilter("bookmarked")}
        >
          ‚òÖ Bookmarked ({duaas.filter(d => d.bookmarked).length})
        </button>
        <button
          className="btn-secondary"
          style={showForm ? { background: "var(--accent-red)", borderColor: "var(--accent-red)", color: "#fff" } : { borderColor: "var(--emerald)", color: "var(--emerald)" }}
          onClick={() => setShowForm(!showForm)}
        >
          {showForm ? "‚úï Cancel" : "+ Add"}
        </button>
      </div>

      {/* Tag filters */}
      <div className="tags-filter">
        <button
          className={`tag-filter-btn ${tagFilter === null ? "active" : ""}`}
          onClick={() => setTagFilter(null)}
        >
          all tags
        </button>
        {usedTags.map(tag => (
          <button
            key={tag}
            className={`tag-filter-btn ${tagFilter === tag ? "active" : ""}`}
            onClick={() => setTagFilter(tagFilter === tag ? null : tag)}
          >
            #{tag}
          </button>
        ))}
      </div>

      {/* Add form */}
      {showForm && (
        <div className="add-duaa-form" style={{ animation: "fadeIn 0.3s ease" }}>
          <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 10, color: "var(--gold)" }}>Add New Du'aa</div>
          <textarea
            className="arabic-textarea"
            placeholder="Arabic text (optional)..."
            value={newDuaa.arabic}
            onChange={e => setNewDuaa(prev => ({ ...prev, arabic: e.target.value }))}
          />
          <textarea
            placeholder="English translation / meaning..."
            value={newDuaa.english}
            onChange={e => setNewDuaa(prev => ({ ...prev, english: e.target.value }))}
          />
          <input
            type="text"
            className="input-field"
            placeholder="Reference (e.g., Quran 2:286, Tirmidhi)"
            value={newDuaa.reference}
            onChange={e => setNewDuaa(prev => ({ ...prev, reference: e.target.value }))}
            style={{ marginBottom: 10 }}
          />
          <div style={{ fontSize: 11, color: "var(--text-muted)", marginBottom: 6 }}>Select tags:</div>
          <div className="tags-filter">
            {ALL_TAGS.map(tag => (
              <button
                key={tag}
                className={`tag-filter-btn ${newDuaa.tags.includes(tag) ? "active" : ""}`}
                onClick={() => toggleNewTag(tag)}
              >
                #{tag}
              </button>
            ))}
          </div>
          <button className="btn-primary" onClick={addDuaa} style={{ marginTop: 8 }}>Save Du'aa</button>
        </div>
      )}

      {/* Duaa list */}
      {filtered.map(duaa => (
        <div key={duaa.id} className="duaa-card">
          {duaa.arabic && <div className="duaa-arabic">{duaa.arabic}</div>}
          <div className="duaa-english">{duaa.english}</div>
          <div className="duaa-ref">{duaa.reference}</div>
          <div className="duaa-footer">
            <div className="duaa-tags">
              {duaa.tags.map(tag => (
                <span key={tag} className="tag">#{tag}</span>
              ))}
            </div>
            <button className="bookmark-btn" onClick={() => toggleBookmark(duaa.id)}>
              {duaa.bookmarked ? "‚òÖ" : "‚òÜ"}
            </button>
          </div>
        </div>
      ))}

      {filtered.length === 0 && (
        <div className="empty-state">
          <div className="icon">üìø</div>
          <div>No du'aas match your filters</div>
        </div>
      )}
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ LAST THIRD OF THE NIGHT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function LastThirdOfNight() {
  const [location, setLocation] = useState(null);
  const [locationName, setLocationName] = useState("");
  const [prayerTimes, setPrayerTimes] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [manualMode, setManualMode] = useState(false);
  const [manualMaghrib, setManualMaghrib] = useState("18:30");
  const [manualFajr, setManualFajr] = useState("05:30");

  const fetchPrayerTimes = useCallback(async (lat, lng) => {
    setLoading(true);
    setError(null);
    try {
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, "0");
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const yyyy = today.getFullYear();
      
      // Fetch today's times (for Maghrib) and tomorrow's times (for Fajr)
      const resp = await fetch(
        `https://api.aladhan.com/v1/timings/${dd}-${mm}-${yyyy}?latitude=${lat}&longitude=${lng}&method=2`
      );
      const data = await resp.json();

      // Get tomorrow for Fajr
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      const dd2 = String(tomorrow.getDate()).padStart(2, "0");
      const mm2 = String(tomorrow.getMonth() + 1).padStart(2, "0");
      const yyyy2 = tomorrow.getFullYear();
      
      const resp2 = await fetch(
        `https://api.aladhan.com/v1/timings/${dd2}-${mm2}-${yyyy2}?latitude=${lat}&longitude=${lng}&method=2`
      );
      const data2 = await resp2.json();

      if (data.code === 200 && data2.code === 200) {
        setPrayerTimes({
          fajr: data.data.timings.Fajr,
          sunrise: data.data.timings.Sunrise,
          dhuhr: data.data.timings.Dhuhr,
          asr: data.data.timings.Asr,
          maghrib: data.data.timings.Maghrib,
          isha: data.data.timings.Isha,
          fajrTomorrow: data2.data.timings.Fajr,
          date: data.data.date.readable,
          hijri: `${data.data.date.hijri.day} ${data.data.date.hijri.month.en} ${data.data.date.hijri.year}`,
        });
      } else {
        setError("Could not fetch prayer times. Try manual mode.");
      }
    } catch (err) {
      setError("Network error fetching prayer times. Try manual mode.");
    }
    setLoading(false);
  }, []);

  const requestLocation = () => {
    setLoading(true);
    setError(null);
    if (!navigator.geolocation) {
      setError("Geolocation is not supported by your browser. Use manual mode.");
      setLoading(false);
      return;
    }
    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        const { latitude, longitude } = pos.coords;
        setLocation({ lat: latitude, lng: longitude });
        // Reverse geocode (simple)
        try {
          const geoResp = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`);
          const geoData = await geoResp.json();
          setLocationName(`${geoData.city || geoData.locality || "Unknown"}, ${geoData.countryName || ""}`);
        } catch {
          setLocationName(`${latitude.toFixed(2)}¬∞, ${longitude.toFixed(2)}¬∞`);
        }
        await fetchPrayerTimes(latitude, longitude);
      },
      (err) => {
        setError("Location access denied. Please enable GPS or use manual mode.");
        setLoading(false);
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  };

  // Calculate last third from two time strings
  const calcLastThird = (maghribStr, fajrStr) => {
    const [mH, mM] = maghribStr.split(":").map(Number);
    const [fH, fM] = fajrStr.split(":").map(Number);

    let maghribMin = mH * 60 + mM;
    let fajrMin = fH * 60 + fM;
    if (fajrMin <= maghribMin) fajrMin += 24 * 60; // next day

    const nightDuration = fajrMin - maghribMin;
    const thirdDuration = nightDuration / 3;

    const lastThirdStart = maghribMin + 2 * thirdDuration;
    const lastThirdStartH = Math.floor((lastThirdStart % (24 * 60)) / 60);
    const lastThirdStartM = Math.round(lastThirdStart % 60);

    const midnightPoint = maghribMin + nightDuration / 2;
    const midnightH = Math.floor((midnightPoint % (24 * 60)) / 60);
    const midnightM = Math.round(midnightPoint % 60);

    const firstThirdEnd = maghribMin + thirdDuration;
    const firstThirdH = Math.floor((firstThirdEnd % (24 * 60)) / 60);
    const firstThirdM = Math.round(firstThirdEnd % 60);

    const fmt = (h, m) => {
      const ampm = h >= 12 ? "PM" : "AM";
      const h12 = h % 12 || 12;
      return `${h12}:${String(m).padStart(2, "0")} ${ampm}`;
    };

    return {
      nightDurationHrs: Math.floor(nightDuration / 60),
      nightDurationMins: Math.round(nightDuration % 60),
      thirdDurationHrs: Math.floor(thirdDuration / 60),
      thirdDurationMins: Math.round(thirdDuration % 60),
      lastThirdStart: fmt(lastThirdStartH, lastThirdStartM),
      lastThirdEnd: fmt(fH, fM),
      islamicMidnight: fmt(midnightH, midnightM),
      firstThirdEnd: fmt(firstThirdH, firstThirdM),
    };
  };

  const maghribTime = prayerTimes?.maghrib || (manualMode ? manualMaghrib : null);
  const fajrTime = prayerTimes?.fajrTomorrow || (manualMode ? manualFajr : null);
  const calculation = (maghribTime && fajrTime) ? calcLastThird(maghribTime, fajrTime) : null;

  const formatPrayerTime = (t) => {
    if (!t) return "--:--";
    const [h, m] = t.split(":").map(Number);
    const ampm = h >= 12 ? "PM" : "AM";
    const h12 = h % 12 || 12;
    return `${h12}:${String(m).padStart(2, "0")} ${ampm}`;
  };

  return (
    <div className="page">
      <div className="section-title">Last Third of the Night</div>
      <div className="section-desc">
        The Prophet Ô∑∫ said: "Our Lord descends every night to the lowest heaven when the last third of the night remains, and says: 'Who is calling upon Me that I may answer? Who is asking of Me that I may give? Who is seeking My forgiveness that I may forgive?'" (Bukhari & Muslim)
      </div>

      {!prayerTimes && !manualMode && (
        <>
          <button className="btn-primary" onClick={requestLocation} disabled={loading} style={{ marginBottom: 12 }}>
            {loading ? "Detecting Location..." : "üìç Use My Location (GPS)"}
          </button>
          <button className="btn-secondary" onClick={() => setManualMode(true)} style={{ width: "100%", marginBottom: 12 }}>
            Enter Times Manually
          </button>
        </>
      )}

      {loading && (
        <div className="status-badge loading">
          <span className="status-dot" />
          Fetching prayer times...
        </div>
      )}

      {error && (
        <div className="status-badge error" style={{ marginBottom: 12 }}>
          <span className="status-dot" />
          {error}
        </div>
      )}

      {/* Manual mode */}
      {manualMode && !prayerTimes && (
        <div className="card">
          <div style={{ fontSize: 14, fontWeight: 600, color: "var(--gold)", marginBottom: 10 }}>Manual Entry</div>
          <div className="input-group">
            <label className="input-label">Maghrib Time (today)</label>
            <input type="time" className="input-field" value={manualMaghrib} onChange={e => setManualMaghrib(e.target.value)} />
          </div>
          <div className="input-group">
            <label className="input-label">Fajr Time (tomorrow)</label>
            <input type="time" className="input-field" value={manualFajr} onChange={e => setManualFajr(e.target.value)} />
          </div>
        </div>
      )}

      {/* Location info */}
      {location && locationName && (
        <div className="status-badge success" style={{ marginBottom: 14 }}>
          <span className="status-dot" />
          {locationName}
        </div>
      )}

      {/* Prayer times from API */}
      {prayerTimes && (
        <div style={{ marginBottom: 16 }}>
          <div style={{ fontSize: 12, color: "var(--text-muted)", marginBottom: 8 }}>
            {prayerTimes.date} ‚Äî {prayerTimes.hijri}
          </div>
          <div style={{ display: "flex", gap: 6, flexWrap: "wrap", marginBottom: 12 }}>
            {["fajr", "sunrise", "dhuhr", "asr", "maghrib", "isha"].map(key => (
              <div key={key} style={{
                flex: "1 1 30%",
                background: "var(--bg-card)",
                border: "1px solid var(--border)",
                borderRadius: 8,
                padding: "8px 10px",
                textAlign: "center",
              }}>
                <div style={{ fontSize: 10, color: "var(--text-muted)", textTransform: "capitalize" }}>{key}</div>
                <div style={{ fontSize: 14, fontWeight: 600, color: key === "maghrib" || key === "fajr" ? "var(--gold)" : "var(--text-primary)" }}>
                  {formatPrayerTime(prayerTimes[key])}
                </div>
              </div>
            ))}
          </div>

          {/* Iftar & Suhoor */}
          <div style={{ display: "flex", gap: 8, marginBottom: 12 }}>
            <div style={{
              flex: 1,
              background: "linear-gradient(135deg, rgba(212, 168, 67, 0.1), rgba(212, 168, 67, 0.05))",
              border: "1px solid rgba(212, 168, 67, 0.3)",
              borderRadius: 10,
              padding: "12px",
              textAlign: "center",
            }}>
              <div style={{ fontSize: 10, color: "var(--gold-dim)", letterSpacing: 1, textTransform: "uppercase" }}>Iftar</div>
              <div style={{ fontSize: 20, fontWeight: 700, color: "var(--gold)" }}>{formatPrayerTime(prayerTimes.maghrib)}</div>
              <div style={{ fontSize: 11, color: "var(--text-muted)" }}>at Maghrib</div>
            </div>
            <div style={{
              flex: 1,
              background: "linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(168, 85, 247, 0.05))",
              border: "1px solid rgba(168, 85, 247, 0.3)",
              borderRadius: 10,
              padding: "12px",
              textAlign: "center",
            }}>
              <div style={{ fontSize: 10, color: "var(--accent-purple)", letterSpacing: 1, textTransform: "uppercase" }}>Suhoor Ends</div>
              <div style={{ fontSize: 20, fontWeight: 700, color: "var(--accent-purple)" }}>{formatPrayerTime(prayerTimes.fajrTomorrow)}</div>
              <div style={{ fontSize: 11, color: "var(--text-muted)" }}>at Fajr (tomorrow)</div>
            </div>
          </div>
        </div>
      )}

      {/* Night calculation */}
      {calculation && (
        <>
          <div className="night-display">
            <div className="night-time-label">Last Third Begins</div>
            <div className="night-time">{calculation.lastThirdStart}</div>
            <div className="night-time-sub">until {calculation.lastThirdEnd} (Fajr)</div>
            <div style={{ marginTop: 12, fontSize: 12, color: "var(--text-muted)" }}>
              Duration: ~{calculation.thirdDurationHrs}h {calculation.thirdDurationMins}m
            </div>
          </div>

          <div className="time-row">
            <span className="time-row-label">Total Night Duration</span>
            <span className="time-row-value">{calculation.nightDurationHrs}h {calculation.nightDurationMins}m</span>
          </div>
          <div className="time-row">
            <span className="time-row-label">Each Third Duration</span>
            <span className="time-row-value">{calculation.thirdDurationHrs}h {calculation.thirdDurationMins}m</span>
          </div>
          <div className="time-row">
            <span className="time-row-label">Islamic Midnight</span>
            <span className="time-row-value">{calculation.islamicMidnight}</span>
          </div>
          <div className="time-row">
            <span className="time-row-label">First Third Ends</span>
            <span className="time-row-value">{calculation.firstThirdEnd}</span>
          </div>
          <div className="time-row">
            <span className="time-row-label">Last Third Begins</span>
            <span className="time-row-value" style={{ color: "var(--accent-purple)" }}>{calculation.lastThirdStart}</span>
          </div>

          <div className="info-box" style={{ marginTop: 14 }}>
            <strong>How it's calculated:</strong> The night in Islam is from Maghrib to Fajr. This duration is divided into three equal parts. The last third is the most blessed time for voluntary prayer (Tahajjud), du'aa, and istighfar.
          </div>

          {prayerTimes && (
            <button className="btn-secondary" onClick={requestLocation} style={{ width: "100%", marginTop: 8 }}>
              üîÑ Refresh Times
            </button>
          )}
        </>
      )}
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN APP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ‚îÄ DHIKR COUNTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const DHIKR_PRESETS = [
  { name: "SubhanAllah", arabic: "ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜŸé Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸê", meaning: "Glory be to Allah", target: 33, color: "#10B981" },
  { name: "Alhamdulillah", arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸ∞ŸáŸê", meaning: "All praise is due to Allah", target: 33, color: "#F59E0B" },
  { name: "Allahu Akbar", arabic: "Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸè ÿ£ŸéŸÉŸíÿ®Ÿéÿ±Ÿè", meaning: "Allah is the Greatest", target: 33, color: "#3B82F6" },
  { name: "La ilaha illallah", arabic: "ŸÑŸéÿß ÿ•ŸêŸÑŸéŸ∞ŸáŸé ÿ•ŸêŸÑŸéŸëÿß Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸè", meaning: "There is no god but Allah", target: 100, color: "#A855F7" },
  { name: "Astaghfirullah", arabic: "ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿè Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸé", meaning: "I seek forgiveness from Allah", target: 100, color: "#EC4899" },
  { name: "La hawla wa la quwwata", arabic: "ŸÑŸéÿß ÿ≠ŸéŸàŸíŸÑŸé ŸàŸéŸÑŸéÿß ŸÇŸèŸàŸéŸëÿ©Ÿé ÿ•ŸêŸÑŸéŸëÿß ÿ®ŸêŸ±ŸÑŸÑŸéŸëŸ∞ŸáŸê", meaning: "There is no power nor strength except with Allah", target: 100, color: "#14B8A6" },
  { name: "Salawat", arabic: "Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâŸ∞ ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç", meaning: "O Allah, send blessings upon Muhammad Ô∑∫", target: 100, color: "#D4A843" },
  { name: "Custom", arabic: "", meaning: "Set your own dhikr", target: 100, color: "#64748B" },
];

function DhikrCounter() {
  const [selectedIdx, setSelectedIdx] = useState(0);
  const [count, setCount] = useState(0);
  const [stepMode, setStepMode] = useState(1); // 1 or 10
  const [target, setTarget] = useState(DHIKR_PRESETS[0].target);
  const [sessions, setSessions] = useState([]);
  const [showPulse, setShowPulse] = useState(false);
  const [customArabic, setCustomArabic] = useState("");
  const [customName, setCustomName] = useState("");

  const preset = DHIKR_PRESETS[selectedIdx];
  const progress = Math.min((count / target) * 100, 100);
  const completed = count >= target;

  const handleTap = () => {
    const newCount = count + stepMode;
    setCount(newCount);
    setShowPulse(true);
    setTimeout(() => setShowPulse(false), 200);

    if (newCount >= target && count < target) {
      // Just completed
      setSessions(prev => [...prev, {
        name: preset.name === "Custom" ? (customName || "Custom") : preset.name,
        count: newCount,
        target,
        time: new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" }),
      }]);
    }
  };

  const handleReset = () => {
    setCount(0);
  };

  const handleSelectPreset = (idx) => {
    setSelectedIdx(idx);
    setCount(0);
    setTarget(DHIKR_PRESETS[idx].target);
  };

  const displayArabic = preset.name === "Custom" ? (customArabic || "Your Dhikr") : preset.arabic;
  const displayName = preset.name === "Custom" ? (customName || "Custom Dhikr") : preset.name;

  // Ring SVG parameters
  const radius = 110;
  const circumference = 2 * Math.PI * radius;
  const strokeDashoffset = circumference - (progress / 100) * circumference;

  return (
    <div className="page">
      <div className="section-title">Dhikr Counter</div>
      <div className="section-desc">Remember Allah often. Tap the circle to count, choose +1 or +10 mode.</div>

      {/* Preset selector */}
      <div style={{ display: "flex", gap: 6, flexWrap: "wrap", marginBottom: 16 }}>
        {DHIKR_PRESETS.map((p, i) => (
          <button
            key={i}
            className={`btn-secondary ${selectedIdx === i ? "active" : ""}`}
            style={selectedIdx === i ? { background: p.color, borderColor: p.color, color: "#0A0F1C", fontSize: 11, padding: "6px 10px" } : { fontSize: 11, padding: "6px 10px" }}
            onClick={() => handleSelectPreset(i)}
          >
            {p.name}
          </button>
        ))}
      </div>

      {/* Custom inputs */}
      {preset.name === "Custom" && (
        <div className="card" style={{ marginBottom: 14 }}>
          <div className="input-group">
            <label className="input-label">Dhikr Name</label>
            <input type="text" className="input-field" placeholder="e.g. Hasbunallah" value={customName} onChange={e => setCustomName(e.target.value)} />
          </div>
          <div className="input-group">
            <label className="input-label">Arabic Text (optional)</label>
            <input type="text" className="input-field arabic" style={{ fontFamily: "'Amiri', serif", fontSize: 20, textAlign: "right", direction: "rtl" }} placeholder="..." value={customArabic} onChange={e => setCustomArabic(e.target.value)} />
          </div>
          <div className="input-group" style={{ marginBottom: 0 }}>
            <label className="input-label">Target Count</label>
            <input type="text" inputMode="numeric" className="input-field" value={target} onChange={e => { const v = parseInt(e.target.value.replace(/[^0-9]/g, "")) || 0; setTarget(v); }} />
          </div>
        </div>
      )}

      {/* Step mode toggle */}
      <div style={{ display: "flex", justifyContent: "center", marginBottom: 16 }}>
        <div className="toggle-tabs">
          <button className={`toggle-tab ${stepMode === 1 ? "active" : ""}`} onClick={() => setStepMode(1)}>+1</button>
          <button className={`toggle-tab ${stepMode === 10 ? "active" : ""}`} onClick={() => setStepMode(10)}>+10</button>
        </div>
      </div>

      {/* Counter circle */}
      <div
        onClick={handleTap}
        style={{
          display: "flex",
          flexDirection: "column",
          alignItems: "center",
          justifyContent: "center",
          cursor: "pointer",
          userSelect: "none",
          WebkitTapHighlightColor: "transparent",
          marginBottom: 20,
          position: "relative",
        }}
      >
        <svg width="260" height="260" viewBox="0 0 260 260" style={{ transform: "rotate(-90deg)" }}>
          {/* Background ring */}
          <circle
            cx="130" cy="130" r={radius}
            fill="none"
            stroke="var(--border)"
            strokeWidth="8"
          />
          {/* Progress ring */}
          <circle
            cx="130" cy="130" r={radius}
            fill="none"
            stroke={completed ? "#10B981" : preset.color}
            strokeWidth="8"
            strokeLinecap="round"
            strokeDasharray={circumference}
            strokeDashoffset={strokeDashoffset}
            style={{ transition: "stroke-dashoffset 0.15s ease, stroke 0.3s ease" }}
          />
        </svg>

        {/* Inner content */}
        <div style={{
          position: "absolute",
          display: "flex",
          flexDirection: "column",
          alignItems: "center",
          justifyContent: "center",
          transform: showPulse ? "scale(1.05)" : "scale(1)",
          transition: "transform 0.15s ease",
        }}>
          <div style={{
            fontFamily: "'Amiri', serif",
            fontSize: preset.name === "La hawla wa la quwwata" || preset.name === "Salawat" ? 18 : 24,
            color: preset.color,
            lineHeight: 1.4,
            textAlign: "center",
            direction: "rtl",
            maxWidth: 180,
            marginBottom: 8,
          }}>
            {displayArabic}
          </div>
          <div style={{
            fontSize: 52,
            fontWeight: 700,
            color: completed ? "#10B981" : "var(--text-primary)",
            lineHeight: 1,
            transition: "color 0.3s ease",
          }}>
            {count}
          </div>
          <div style={{ fontSize: 13, color: "var(--text-muted)", marginTop: 4 }}>
            of {target}
          </div>
          {completed && (
            <div style={{
              fontSize: 11,
              color: "#10B981",
              fontWeight: 600,
              marginTop: 4,
              textTransform: "uppercase",
              letterSpacing: 1,
            }}>
              ‚úì Completed
            </div>
          )}
        </div>
      </div>

      {/* Dhikr name & meaning below circle */}
      <div style={{ textAlign: "center", marginBottom: 16 }}>
        <div style={{ fontSize: 15, fontWeight: 600, color: "var(--text-primary)" }}>{displayName}</div>
        {preset.meaning && <div style={{ fontSize: 12, color: "var(--text-muted)", marginTop: 2 }}>{preset.meaning}</div>}
      </div>

      {/* Reset button */}
      <div style={{ display: "flex", gap: 8, justifyContent: "center", marginBottom: 24 }}>
        <button className="btn-secondary" onClick={handleReset}>Reset Counter</button>
        {!completed && target > 0 && (
          <button className="btn-secondary" onClick={() => { setCount(target); setSessions(prev => [...prev, { name: displayName, count: target, target, time: new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" }) }]); }}>
            Complete Set
          </button>
        )}
      </div>

      {/* Today's sessions */}
      {sessions.length > 0 && (
        <>
          <div className="divider" />
          <div style={{ fontSize: 14, fontWeight: 600, color: "var(--gold)", marginBottom: 10 }}>Today's Sessions</div>
          {sessions.map((s, i) => (
            <div key={i} className="time-row">
              <div>
                <span className="time-row-label">{s.name}</span>
                <span style={{ fontSize: 11, color: "var(--text-muted)", marginLeft: 8 }}>{s.time}</span>
              </div>
              <span className="time-row-value" style={{ color: "#10B981" }}>‚úì {s.count}/{s.target}</span>
            </div>
          ))}
          <div style={{ textAlign: "center", marginTop: 10 }}>
            <button className="btn-secondary" onClick={() => setSessions([])} style={{ fontSize: 11 }}>Clear Sessions</button>
          </div>
        </>
      )}

      <div className="info-box" style={{ marginTop: 16 }}>
        <strong>After every Fard prayer:</strong> Say SubhanAllah 33√ó, Alhamdulillah 33√ó, and Allahu Akbar 33√ó (or 34√ó) to complete 100. The Prophet Ô∑∫ said: "Whoever glorifies Allah after every prayer 33 times‚Ä¶ these are 99 and then says to complete 100: La ilaha illallah‚Ä¶ his sins will be forgiven even if they were like the foam of the sea." (Muslim)
      </div>
    </div>
  );
}

const TABS = [
  { id: "salah", label: "üïå Salah", icon: "üïå" },
  { id: "zakat", label: "üí∞ Zakat", icon: "üí∞" },
  { id: "names", label: "Ô∑Ω 99 Names", icon: "Ô∑Ω" },
  { id: "ramadan", label: "üåô Ramadan", icon: "üåô" },
  { id: "dhikr", label: "üìø Dhikr", icon: "üìø" },
  { id: "duaa", label: "ü§≤ Du'aa", icon: "ü§≤" },
  { id: "night", label: "üåÉ Night", icon: "üåÉ" },
];

function MuslimCompanionApp() {
  const [activeTab, setActiveTab] = useState("salah");

  return (
    <>
      <style>{styles}</style>
      <div className="app-container">
        <div className="app-header">
          <div className="app-title">Muslim Companion</div>
          <div className="app-subtitle">Your Daily Islamic Guide</div>
        </div>
        <div className="geo-pattern" />

        <nav className="nav-bar">
          {TABS.map(tab => (
            <button
              key={tab.id}
              className={`nav-btn ${activeTab === tab.id ? "active" : ""}`}
              onClick={() => setActiveTab(tab.id)}
            >
              {tab.label}
            </button>
          ))}
        </nav>

        {activeTab === "salah" && <SalahTracker />}
        {activeTab === "zakat" && <ZakatCalculator />}
        {activeTab === "names" && <NamesOfAllah />}
        {activeTab === "ramadan" && <RamadanTracker />}
        {activeTab === "dhikr" && <DhikrCounter />}
        {activeTab === "duaa" && <DuaaJournal />}
        {activeTab === "night" && <LastThirdOfNight />}
      </div>
    </>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(MuslimCompanionApp));

// Remove splash screen once rendered
setTimeout(() => {
  const splash = document.getElementById('splash');
  if (splash) splash.style.display = 'none';
}, 100);
  </script>
</body>
</html>
